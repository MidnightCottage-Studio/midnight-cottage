<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ã‚³ãƒ†ãƒ¼ã‚¸ (Midnight Cottage)</title>
    <style>
        :root {
            --bg: #09090d; --card: #12121a; --accent: #bb9af7; --gold: #ff9e64;
            --neon-blue: #7aa2f7; --heart: #f7768e; --text: #c0caf5; --border: rgba(187, 154, 247, 0.2);
            --female-bg: rgba(255, 182, 193, 0.35); --male-bg: rgba(135, 206, 235, 0.35);
            --healing: #50fa7b; --danger: #ff5555;
        }
        body { font-family: 'Pretendard', 'Noto Sans JP', sans-serif; background-color: #050507; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; color: var(--text); overflow: hidden; user-select: none; }
        
        /* PC åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        #app { width: 98%; max-width: 1350px; height: 96vh; background: var(--bg); border-radius: 24px; display: flex; flex-direction: column; position: relative; transition: all 0.5s ease; box-shadow: 0 0 80px rgba(0,0,0,1); box-sizing: border-box; }
        
        .app-header { padding: 15px 30px; display: grid; grid-template-columns: 350px 1fr 500px; align-items: center; background: rgba(0,0,0,0.5); border-bottom: 1px solid var(--border); border-radius: 24px 24px 0 0; z-index: 10; height: auto; min-height: 60px; }
        .header-left { display: flex; flex-direction: column; gap: 8px; }
        .budget-display { font-size: 32px; font-weight: 800; color: var(--gold); display: flex; align-items: center; gap: 10px; }
        #news-banner { font-size: 12px; color: var(--neon-blue); font-weight: 700; background: rgba(122, 162, 247, 0.1); padding: 4px 10px; border-radius: 6px; margin-top: 2px; border-left: 3px solid var(--neon-blue); width: fit-content; max-width: 320px; }
        
        /* PCå°‚ç”¨ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        #pc-city-status { display: flex; flex-direction: column; gap: 5px; margin-top: 5px; }
        #city-name-display { font-size: 17px; color: var(--accent); font-weight: 800; text-shadow: 0 0 10px rgba(187, 154, 247, 0.5); }
        .dev-bar-bg { width: 100%; height: 6px; background: #222; border-radius: 3px; overflow: hidden; }
        #dev-bar-fill { width: 0%; height: 100%; background: var(--gold); box-shadow: 0 0 10px var(--gold); transition: width 0.4s ease; }

        /* ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        #mobile-city-status { display: none; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; padding: 10px; margin-bottom: 5px; flex-direction: column; gap: 4px; }
        #mob-city-name-display { font-size: 15px; color: var(--accent); font-weight: 800; text-shadow: 0 0 10px rgba(187, 154, 247, 0.5); }
        .mob-dev-bar-bg { width: 100%; height: 6px; background: #222; border-radius: 4px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); margin-top: 2px; }
        #mob-dev-bar-fill { width: 0%; height: 100%; background: var(--gold); box-shadow: 0 0 10px var(--gold); transition: width 0.4s ease; }
        
        .res-area { display: flex; justify-content: center; gap: 10px; }
        .res-card { display: flex; flex-direction: column; align-items: center; width: 85px; cursor: pointer; position: relative; transition: 0.2s; }
        .res-card:hover { transform: translateY(-5px); }
        .res-icon-box { width: 50px; height: 50px; border-radius: 14px; border: 1px solid var(--border); display: flex; justify-content: center; align-items: center; font-size: 24px; position: relative; }
        .stress-box { width: 100%; height: 5px; background: #222; border-radius: 3px; margin-top: 6px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
        .stress-fill { height: 100%; background: var(--heart); transition: width 0.3s ease; }
        .res-name { font-size: 13px; margin-top: 4px; font-weight: 800; color: #fff; }
        .res-job { font-size: 9px; color: var(--neon-blue); font-weight: 700; margin-top: 1px; }
        .res-rel { font-size: 9px; color: var(--heart); font-weight: 800; text-align: center; min-height: 24px; margin-top: 2px; line-height: 1.2; }
        
        .header-right { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
        .top-buttons { display: flex; gap: 8px; }
        .icon-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text); border-radius: 50%; width: 38px; height: 38px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 18px; transition: 0.3s; position: relative; }
        .icon-btn:hover { background: var(--border); transform: scale(1.1); }
        .noti-dot { position: absolute; top: 0; right: 0; width: 10px; height: 10px; background: var(--danger); border-radius: 50%; border: 2px solid var(--bg); display: none; }
        
        /* PC ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚° */
        #event-log { 
            font-size: 19px; 
            color: var(--accent); 
            font-weight: 800; 
            text-align: right; 
            line-height: 1.3; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-end; 
            justify-content: flex-end;
            word-break: keep-all; 
            min-height: 50px; 
        }

        .content-container { flex: 1; display: flex; overflow: hidden; }
        .main-panel { flex: 1.8; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        #desk-clicker { width: 100%; max-width: 480px; cursor: pointer; transition: transform 0.1s ease, filter 0.3s ease; filter: drop-shadow(0 0 30px rgba(187, 154, 247, 0.2)); margin-top: 40px; margin-bottom: 20px; }
        #desk-clicker:active { transform: scale(0.95); }
        .hit-effect { position: absolute; pointer-events: none; font-size: 65px; z-index: 100; animation: hit-star 0.3s ease-out forwards; }
        @keyframes hit-star { 0% { transform: scale(0.5); opacity: 0; } 50% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.1); opacity: 0; } }
        
        /* å¯¾è©±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ */
        #dialogue-stack { 
            position: absolute; bottom: 120px; z-index: 50; width: 90%; max-width: 500px; 
            display: flex; flex-direction: column-reverse; align-items: center; gap: 8px; pointer-events: none; 
        }
        .dialogue-bubble { 
            background: rgba(0,0,0,0.85); border: 2px solid var(--accent); border-radius: 20px; padding: 12px 20px; 
            font-size: 15px; font-weight: 700; color: #fff; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            animation: slide-up-fade 0.3s ease-out forwards; max-width: 100%; pointer-events: none;
        }
        .dialogue-bubble.event { border-color: var(--accent); color: var(--accent); }
        @keyframes slide-up-fade {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-out-bubble {
            to { opacity: 0; transform: translateY(-10px); }
        }

        .side-menu { flex: 1.1; background: rgba(0,0,0,0.4); padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; box-sizing: border-box; border-left: 1px solid var(--border); }
        .menu-title { font-size: 17px; font-weight: 800; color: var(--gold); border-left: 4px solid var(--gold); padding-left: 12px; margin-bottom: 10px; }
        
        /* ã‚«ãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .up-card { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 12px 15px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.03); width: 100%; box-sizing: border-box; min-height: 80px; }
        .up-info { flex: 1; min-width: 0; margin-right: 10px; display: flex; flex-direction: column; justify-content: center; gap: 4px; }
        .up-info h4 { margin: 0; font-size: 15px; color: #eee; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .up-info p { margin: 0; font-size: 13px; color: #aaa; white-space: nowrap; }
        .tags { display: flex; gap: 5px; margin-top: 0; }
        .tag-dev { font-size: 9px; background: rgba(255, 158, 100, 0.2); color: var(--gold); padding: 1px 5px; border-radius: 4px; font-weight: 700; }
        .tag-healing { font-size: 10px; background: rgba(80, 250, 123, 0.2); color: var(--healing); padding: 1px 5px; border-radius: 4px; font-weight: 700; }
        .buy-btn { background: transparent; border: 1.5px solid var(--gold); color: var(--gold); padding: 8px 10px; border-radius: 10px; font-size: 13px; font-weight: 900; cursor: pointer; min-width: 80px; flex-shrink: 0; text-align: center; }
        .buy-btn:disabled { border-color: #2a2a2a; color: #444; }
        
        .toast { background: var(--gold); color: #000; padding: 12px 24px; border-radius: 50px; font-weight: 900; font-size: 18px; box-shadow: 0 0 30px var(--gold); animation: toast-pop 3s forwards; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .evo-toast { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); background: var(--accent); color: #000; padding: 20px 40px; border-radius: 15px; font-size: 24px; font-weight: 900; z-index: 2000; animation: evo-pop 4s forwards; box-shadow: 0 0 50px var(--accent); text-align: center; border: 4px solid #fff; }
        .center-popup { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10, 10, 15, 0.95); border: 2px solid var(--accent); color: var(--accent); padding: 25px 50px; border-radius: 20px; font-size: 22px; font-weight: 900; z-index: 2000; animation: fade-in-out 3s forwards; box-shadow: 0 0 40px rgba(187, 154, 247, 0.4); text-align: center; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        @keyframes fade-in-out { 0% { opacity:0; transform:translate(-50%, -40%); } 15% { opacity:1; transform:translate(-50%, -50%); } 85% { opacity:1; transform:translate(-50%, -50%); } 100% { opacity:0; transform:translate(-50%, -60%); } }
        @keyframes evo-pop { 0% { opacity:0; transform:translate(-50%, -30%) scale(0.8); } 10% { opacity:1; transform:translate(-50%, -50%) scale(1.1); } 20% { transform:translate(-50%, -50%) scale(1); } 90% { opacity:1; } 100% { opacity:0; transform:translate(-50%, -70%) scale(0.8); } }
        @keyframes toast-pop { 0% { opacity:0; transform:translateY(20px); } 15% { opacity:1; transform:translateY(0); } 85% { opacity:1; transform:translateY(0); } 100% { opacity:0; transform:translateY(-20px); } }
        
        .modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 200; padding: 40px; text-align: center; border-radius: 24px; box-sizing: border-box; backdrop-filter: blur(5px); }
        .modal h2 { margin-top: 0; margin-bottom: 30px; font-size: 28px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; width: 90%; overflow-y: auto; padding: 10px; max-height: 70vh; box-sizing: border-box; }
        .gallery-item { cursor: pointer; border-radius: 12px; border: 2px solid transparent; transition: 0.3s; overflow: hidden; position: relative; background: #181820; display: flex; flex-direction: column; padding-bottom: 10px; height: auto; }
        .gallery-item img { width: 100%; height: 110px; object-fit: cover; opacity: 0.4; display: block; border-bottom: 1px solid #333; }
        .gallery-item.unlocked img { opacity: 1; }
        .gallery-item.active { border-color: var(--gold); box-shadow: 0 0 20px rgba(255, 158, 100, 0.3); }
        .gallery-item div { padding: 5px 10px; box-sizing: border-box; line-height: 1.2; }
        .gallery-item.locked img { display: block; opacity: 0.15; filter: blur(3px) grayscale(100%); }
        .gallery-item.locked::before { content: 'ğŸ”’'; font-size: 24px; position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); z-index: 5; opacity: 0.7; }
        .museum-container { display: flex; flex-direction: column; align-items: center; gap: 30px; width: 100%; height: 100%; justify-content: center; pointer-events: none; }
        .museum-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; padding: 10px; pointer-events: auto; }
        .artifact-slot { width: 85px; height: 85px; background: #111; border: 1px solid var(--border); display: flex; justify-content: center; align-items: center; border-radius: 15px; cursor: pointer; font-size: 32px; transition: 0.3s; pointer-events: auto; }
        .artifact-slot.found { border-color: var(--gold); box-shadow: 0 0 15px rgba(255, 158, 100, 0.3); }
        #artifact-desc { pointer-events: auto; color:#aaa; font-style:italic; font-size: 18px; margin-top: 20px; }
        #history-list li { margin-bottom: 12px; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 15px; color: #ccc; }
        
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #050507; z-index: 3000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--text); }
        .start-form { background: var(--card); padding: 40px; border-radius: 24px; border: 1px solid var(--border); width: 400px; display: flex; flex-direction: column; gap: 20px; box-shadow: 0 0 50px rgba(0,0,0,0.8); position: relative; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group label { font-size: 14px; font-weight: 700; color: var(--gold); }
        .form-group input, .form-group select { background: #1a1a24; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; font-size: 16px; font-family: 'Pretendard', sans-serif; outline: none; }
        .form-group input::placeholder { color: #666; font-style: italic; }
        .form-group input:focus, .form-group select:focus { border-color: var(--neon-blue); }
        .nav-btns { display: flex; gap: 10px; margin-top: 15px; }
        .start-btn { flex: 1; background: var(--accent); color: #000; padding: 15px; border-radius: 12px; font-size: 18px; font-weight: 900; border: none; cursor: pointer; transition: 0.3s; }
        .start-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--accent); }
        .prev-btn { flex: 0.4; background: #333; color: #fff; border-radius: 12px; font-weight: 700; border:none; cursor: pointer; }
        .finish-btn { flex: 1; background: #50fa7b; color: #000; padding: 15px; border-radius: 12px; font-size: 18px; font-weight: 900; border: none; cursor: pointer; transition: 0.3s; display: none; }
        .finish-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px #50fa7b; }
        #char-count { position: absolute; top: 20px; right: 20px; font-size: 14px; color: #666; font-weight: 900; }
        .sns-container { width: 450px; height: 600px; background: var(--card); border: 2px solid var(--border); border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; }
        .sns-header { background: rgba(0,0,0,0.5); padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .sns-feed { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .sns-post { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .sns-user { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }
        .sns-avatar { width: 30px; height: 30px; background: #333; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 18px; }
        .sns-name { font-size: 14px; font-weight: 700; color: #fff; }
        .sns-time { font-size: 11px; color: #666; margin-left: auto; }
        .sns-text { font-size: 13px; color: #ccc; line-height: 1.4; }
        
        .gacha-container { display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 400px; text-align: center; }
        .gacha-btn { background: var(--accent); color: #000; padding: 20px; border-radius: 15px; font-weight: 900; font-size: 20px; border: none; cursor: pointer; transition: 0.3s; box-shadow: 0 0 20px rgba(187, 154, 247, 0.4); display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .gacha-btn:hover { transform: scale(1.05); }
        .gacha-btn:disabled { filter: grayscale(100%); opacity: 0.5; cursor: not-allowed; transform: none; }
        .gacha-cost { font-size: 14px; opacity: 0.8; }
        
        .ach-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 500px; max-height: 500px; overflow-y: auto; }
        .ach-item { background: #1a1a24; padding: 15px; border-radius: 12px; border: 1px solid #333; opacity: 0.5; transition: 0.3s; }
        .ach-item.unlocked { opacity: 1; border-color: var(--gold); background: rgba(255, 158, 100, 0.05); }
        .ach-icon { font-size: 24px; margin-bottom: 5px; }
        .ach-title { font-weight: 800; color: #fff; font-size: 14px; }
        .ach-desc { font-size: 11px; color: #aaa; margin-top: 3px; }
        
        /* ğŸ’Œ ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ */
        #ending-sequence { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 6000; display: none; flex-direction: column; justify-content: center; align-items: center; }
        .rolling-container { text-align: center; opacity: 0; transform: translateY(20px); transition: 1s ease; display: flex; flex-direction: column; align-items: center; }
        .rolling-container.show { opacity: 1; transform: translateY(0); }
        .end-emoji { font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 0 20px var(--accent)); }
        .end-name { font-size: 24px; font-weight: 800; color: var(--gold); margin-bottom: 20px; }
        .end-msg { font-size: 22px; color: #fff; font-weight: 300; line-height: 1.6; max-width: 80%; margin: 0 auto; word-break: keep-all; font-family: 'Pretendard', serif; }
        .ending-btn { background: var(--gold); color: #000; padding: 15px 30px; border-radius: 30px; font-weight: 900; font-size: 18px; border: none; cursor: pointer; transition: 0.3s; }
        .ending-btn:hover { transform: scale(1.1); box-shadow: 0 0 30px var(--gold); }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

        /* ğŸŒŸ 2. ãƒ¢ãƒã‚¤ãƒ«ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– CSS */
        @media (max-width: 768px) {
            body { height: 100vh; overflow: hidden; position: fixed; width: 100%; }
            #app { height: 100%; width: 100%; border-radius: 0; display: flex; flex-direction: column; }

            /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä½™ç™½èª¿æ•´ */
            .app-header { display: flex; flex-direction: column; padding: 5px 15px 0px 15px; gap: 0px; height: auto; flex-shrink: 0; align-items: center; border-bottom: none; }
            
            .header-left { width: 100%; order: 1; align-items: flex-start; margin-bottom: 0px; }
            .budget-display { font-size: 24px; margin: 0; justify-content: flex-start; white-space: nowrap; width: 100%; }
            #news-banner { display: none; }
            #pc-city-status { display: none; }

            /* ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®ä¸­å¤®æƒãˆ */
            .header-right { width: 100%; order: 2; display: flex; justify-content: center; align-items: center; margin-bottom: 10px; margin-top: 5px; }
            .top-buttons { width: 100%; display: flex; gap: 12px; margin: 0; flex-wrap: nowrap; overflow-x: auto; justify-content: center; }
            .icon-btn { width: 38px; height: 38px; font-size: 18px; flex-shrink: 0; }
            
            #event-log { display: none !important; }

            /* ä½æ°‘ãƒªã‚¹ãƒˆã®ä¸­å¤®æƒãˆ */
            .res-area { order: 3; width: 100%; margin-top: 5px; padding-bottom: 5px; overflow-x: auto; justify-content: center; display: flex; }
            .res-card { min-width: 55px; margin-right: 5px; transform: none !important; transition: none !important; }
            .res-card:hover, .res-card:active { transform: none !important; margin-top: 0 !important; }
            .res-icon-box { width: 40px; height: 40px; font-size: 20px; }
            .res-name { font-size: 10px; margin-top: 2px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; }
            
            /* è·æ¥­ã¨é–¢ä¿‚(ã‚½ãƒ­/ã‚«ãƒƒãƒ—ãƒ«)ã‚’è¡¨ç¤º */
            .res-job { 
                display: block !important; 
                font-size: 8px; 
                color: var(--neon-blue); 
                margin-top: 1px;
                white-space: nowrap;
            }
            .res-rel { 
                display: block !important; 
                font-size: 8px; 
                color: var(--heart); 
                margin-top: 0px;
                white-space: nowrap;
            }

            .content-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

            /* éƒ¨å±‹ã®ç”»åƒã‚’æ‹¡å¤§ */
            .main-panel { flex: 0 0 45%; padding: 0; order: 1; position: relative; background: #000; display: flex; justify-content: center; align-items: center; overflow: hidden; }
            #desk-clicker { width: 130%; height: 130%; object-fit: contain; margin: 0; transform: translateY(-10px); }
            
            #dialogue-stack { bottom: 10px; width: 90%; gap: 6px; }
            .dialogue-bubble { font-size: 13px; padding: 10px; }

            .side-menu { flex: 1; order: 2; height: auto; overflow-y: auto; border-top: 2px solid var(--border); background: rgba(0,0,0,0.9); padding: 10px 15px 80px 15px; }
            #mobile-city-status { display: flex; margin-bottom: 5px; padding: 8px; } 
            
            .menu-title { margin-bottom: 5px; text-align: left; border-left: none; padding-left: 0; }
            
            .up-card { flex-direction: column; align-items: flex-start; padding: 12px; min-height: auto; margin-bottom: 8px; gap: 8px; }
            .up-info { width: 100%; margin-right: 0; }
            .up-info h4, .up-info p { white-space: normal; word-break: keep-all; overflow: visible; } 
            .buy-btn { width: 100%; margin-top: 5px; height: 40px; } 

            .evo-toast { width: 85%; min-width: unset; white-space: nowrap; font-size: 16px; padding: 12px 10px; bottom: 35%; border-width: 2px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; }

            .modal h2, #history-modal h2 { margin-top: 0 !important; margin-bottom: 15px !important; padding-top: 0 !important; line-height: 1.2; transform: translateY(-10px); }
            #history-list { padding-top: 0 !important; margin-top: 0 !important; }

            .sns-container { width: 100%; height: 75%; margin-top: -20px; margin-bottom: 20px; }

            .museum-container { width: 100%; display: flex; flex-direction: column; padding: 10px 0; overflow-x: hidden; height: 100%; }
            .museum-container h2 { order: 1; flex-shrink: 0; }
            #artifact-desc { order: 2; margin-bottom: 10px; margin-top: 0; font-size: 13px; color: var(--neon-blue); min-height: 20px; flex-shrink: 0; }
            .museum-grid { order: 3; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; width: 95%; margin: 0 auto; padding: 0 5px 100px 5px; box-sizing: border-box; overflow-y: auto; }
            .artifact-slot { width: 100%; aspect-ratio: 1 / 1; font-size: 14px; } 

            .gallery-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 10px 5px 80px 5px; width: 100%; box-sizing: border-box; overflow-y: auto; }
            .gallery-item { width: 100%; height: auto; display: flex; flex-direction: column; }
            .gallery-item img { width: 100%; height: auto; aspect-ratio: 16 / 9; object-fit: cover; }

            .modal { position: fixed; top: 0; left: 0; height: 100vh; width: 100vw; z-index: 9999; padding: 20px; box-sizing: border-box; }
            .start-form { width: 90%; max-width: 350px; padding: 20px; box-sizing: border-box; margin: 0 auto; }
            .gacha-container { width: 100%; }
        }

        @keyframes boing {
            0% { transform: scale(1); }
            40% { transform: scale(0.9); }  
            60% { transform: scale(1.1); }  
            100% { transform: scale(1); }   
        }
        .click-animate {
            animation: boing 0.3s ease-out forwards;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="start-screen" style="display:flex;">
        <div class="start-form">
            <h2 style="text-align:center; color:var(--accent); margin-bottom:10px;">ğŸ“„ å…¥å±…ç”³è¾¼æ›¸</h2>
            
            <div id="char-count">1 / 5</div>
            <div class="form-group">
                <label>åå‰ (ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ )</label>
                <input type="text" id="input-name" placeholder="åå‰ã‚’æ±ºã‚ã¦ãã ã•ã„">
            </div>
            <div class="form-group">
                <label>æ€§åˆ¥</label>
                <select id="input-gender">
                    <option value="ë‚¨">ç”·æ€§</option>
                    <option value="ì—¬">å¥³æ€§</option>
                    <option value="ë¬´">ç„¡æ€§/ãã®ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label>è·æ¥­ (é¸æŠ)</label>
                <select id="input-job">
                    <option value="ç”»å®¶">ğŸ¨ ç”»å®¶</option>
                    <option value="å°èª¬å®¶">âœï¸ å°èª¬å®¶</option>
                    <option value="æ•™æˆ">ğŸ“š æ•™æˆ</option>
                    <option value="ãƒªãƒ‘ãƒ¼ãƒ‰ã‚¯">ğŸ› ï¸ ãƒªãƒ‘ãƒ¼ãƒ‰ã‚¯</option>
                    <option value="ASMR DJ">ğŸ§ ASMR DJ</option>
                    <option value="ãƒ¢ãƒ‡ãƒ«">ğŸ‘  ãƒ¢ãƒ‡ãƒ«</option>
                    <option value="åˆ‘äº‹">ğŸ•µï¸ åˆ‘äº‹</option>
                    <option value="ãƒãƒƒãƒˆãƒ©ãƒ³ãƒŠãƒ¼">ğŸ’» ãƒãƒƒãƒˆãƒ©ãƒ³ãƒŠãƒ¼</option>
                    <option value="ãƒ©ãƒ¼ãƒ¡ãƒ³å±‹">ğŸœ ãƒ©ãƒ¼ãƒ¡ãƒ³å±‹å°ã®åº—ä¸»</option>
                    <option value="æ¸©æ³‰ä¸»äºº">â™¨ï¸ æ¸©æ³‰æ—…é¤¨ã®ä¸»äºº</option>
                    <option value="ãƒãƒ¼ãƒã‚¹ã‚¿ãƒ¼">ğŸ’¿ ãƒ¬ã‚³ãƒ¼ãƒ‰ãƒãƒ¼ã®ãƒã‚¹ã‚¿ãƒ¼</option>
                    <option value="ãƒŸãƒ¥ãƒ¼ã‚¸ã‚·ãƒ£ãƒ³">ğŸ¸ ãƒŸãƒ¥ãƒ¼ã‚¸ã‚·ãƒ£ãƒ³</option>
                    <option value="çŒ«">ğŸ± çŒ«</option>
                    <option value="VIP">ğŸ‘‘ VIP</option>
                </select>
            </div>
            <div class="nav-btns">
                <button class="prev-btn" onclick="prevChar()" id="btn-prev" style="display:none;">æˆ»ã‚‹</button>
                <button class="start-btn" onclick="nextChar()" id="btn-next">è¿½åŠ  (1/5)</button>
                <button class="finish-btn" onclick="finishSetup()" id="btn-finish">å…¥å±…é–‹å§‹</button>
            </div>
        </div>
    </div>

    <div id="ending-sequence">
        <div class="rolling-container">
            <div id="end-emoji" class="end-emoji"></div>
            <div id="end-name" class="end-name"></div>
            <div id="end-msg" class="end-msg"></div>
        </div>
        <div id="final-screen" style="display:none; text-align:center; z-index:6005;">
            <h1 style="font-size:40px; color:var(--accent); margin-bottom:20px;">The End</h1>
            <p style="color:#ccc; margin-bottom:30px; line-height: 1.6;">
                ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ã‚³ãƒ†ãƒ¼ã‚¸ã®å¤œã¯ç¶šãã¾ã™ã€‚<br>
                ã‚ãªãŸã®ä½œæ¥­ã‚‚ã€å½¼ã‚‰ã®ã‚ˆã†ã«è¼ãã¾ã™ã‚ˆã†ã«ã€‚
            </p>
            <button class="ending-btn" onclick="closeEndingSequence()">æ®‹ã£ã¦ç¶šã‘ã‚‹</button>
        </div>
    </div>

    <div id="toast-container"></div>
    
    <div class="app-header">
        <div class="header-left">
            <div class="budget-display">ğŸ’µ <span id="budget">0</span></div>
            <div id="news-banner">ğŸ“¢ ãƒ‹ãƒ¥ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ä¸­...</div>
            <div id="pc-city-status">
                <div id="city-name-display">ç´ æœ´ã§å±…å¿ƒåœ°ã®è‰¯ã„ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ã®éƒ¨å±‹</div>
                <div style="display:flex; justify-content:space-between; align-items:center; font-size:11px; margin-bottom:3px; margin-top:2px;">
                    <div style="display:flex; align-items:center; gap:4px;">
                        <span style="color:var(--gold); font-weight:800;">â­ ç™ºå±•åº¦</span>
                        <div onclick="toggleModal('dev-info-modal')" 
                             style="cursor:pointer; border:1px solid #666; border-radius:50%; width:13px; height:13px; display:flex; justify-content:center; align-items:center; color:#aaa; font-size:9px;">?</div>
                    </div>
                    <div id="dev-count" style="color:#fff; font-weight:700;">0 / 5</div>
                </div>
                <div class="dev-bar-bg"><div id="dev-bar-fill"></div></div>
            </div>
        </div>
        
        <div class="res-area" id="res-grid"></div>
        
        <div class="header-right">
            <div class="top-buttons">
                <button class="icon-btn" onclick="toggleModal('shop-modal')">ğŸº</button>
                <button class="icon-btn" onclick="toggleModal('sns-modal')">ğŸ“±<div id="sns-dot" class="noti-dot"></div></button>
                <button class="icon-btn" onclick="toggleModal('ach-modal')">ğŸ†</button>
                <button class="icon-btn" onclick="openGallery()">ğŸ–¼ï¸</button>
                <button class="icon-btn" onclick="toggleModal('museum-modal')" style="font-size:12px !important;">ğŸ›ï¸</button>
                <button class="icon-btn" onclick="toggleModal('history-modal')">ğŸ“œ</button>
                <button class="icon-btn" onclick="toggleModal('help-modal')">?</button>
            </div>
            <div id="event-log">ğŸ’»ä½œæ¥­ãƒ•ã‚¡ã‚¤ãƒˆï¼ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ã‚³ãƒ†ãƒ¼ã‚¸ã¸ã‚ˆã†ã“ãã€‚</div>
        </div>
    </div>

    <div class="content-container">
        <div class="main-panel">
            <img id="desk-clicker" src="https://i.imgur.com/MuFQQ5A.png" alt="City Image">
            <div id="dialogue-stack"></div>
        </div>
        <div class="side-menu">
            <div class="menu-title">ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆã‚·ãƒ†ã‚£é–‹ç™ºæ—¥èªŒ <span id="artifact-boost" style="font-size:11px; color:var(--gold)"></span></div>
            
            <div id="mobile-city-status">
                <div id="mob-city-name-display">ç´ æœ´ã§å±…å¿ƒåœ°ã®è‰¯ã„ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ã®éƒ¨å±‹</div>
                <div style="display:flex; justify-content:space-between; align-items:center; font-size:11px; margin-bottom:3px; margin-top:2px;">
                    <div style="display:flex; align-items:center; gap:4px;">
                        <span style="color:var(--gold); font-weight:800;">â­ ç™ºå±•åº¦</span>
                        <div onclick="toggleModal('dev-info-modal')" 
                             style="cursor:pointer; border:1px solid #666; border-radius:50%; width:13px; height:13px; display:flex; justify-content:center; align-items:center; color:#aaa; font-size:9px;">?</div>
                    </div>
                    <div id="mob-dev-count" style="color:#fff; font-weight:700;">0 / 5</div>
                </div>
                <div class="mob-dev-bar-bg"><div id="mob-dev-bar-fill"></div></div>
            </div>

            <div id="upgrade-list"></div>
        </div>
    </div>

    <div id="gallery-modal" class="modal" onclick="closeModalByBg(event, 'gallery-modal')">
        <h2 style="color:var(--gold); pointer-events:none;">ğŸ–¼ï¸ ã‚³ãƒ†ãƒ¼ã‚¸ãƒ»ãƒ«ãƒ¼ãƒ ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h2>
        <div id="gallery-grid" class="gallery-grid" onclick="event.stopPropagation()"></div>
    </div>
    <div id="museum-modal" class="modal" onclick="closeModalByBg(event, 'museum-modal')">
        <div class="museum-container">
            <h2 style="color:var(--gold); margin: 0; pointer-events: none;">ğŸ›ï¸ 2202å¹´ æ­´å²åšç‰©é¤¨ (2026å¹´ã®éºç‰©)</h2>
            <div id="museum-list" class="museum-grid"></div>
            <p id="artifact-desc" style="pointer-events: none;">éºç‰©ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ†ã‚ªæ•™æˆã®ä¸€è¨€è§£èª¬ãŒå‡ºã¾ã™ã€‚</p>
        </div>
    </div>
    <div id="history-modal" class="modal" onclick="closeModalByBg(event, 'history-modal')">
        <h2 style="color:var(--accent); margin-bottom: 20px; pointer-events:none;">ğŸ“œ ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ã‚³ãƒ†ãƒ¼ã‚¸ã®è¨˜éŒ²</h2>
        <ul id="history-list" style="width:90%; text-align:left; overflow-y:auto; max-height:500px; padding:0 30px; list-style:none;" onclick="event.stopPropagation()"></ul>
    </div>
    <div id="shop-modal" class="modal" onclick="closeModalByBg(event, 'shop-modal')">
        <h2 style="color:#bd93f9;">ğŸº å¤ä»£éºç‰©åšç‰©é¤¨ (Artifacts)</h2>
        <div class="gacha-container" onclick="event.stopPropagation()">
            <p style="color:#ccc; font-size:14px; margin-bottom:20px;">
                2026å¹´ã®å¿˜ã‚Œå»ã‚‰ã‚ŒãŸå¤ä»£éºç‰©ã‚’ç™ºæ˜ã—ã€å¾©å…ƒã™ã‚‹å ´æ‰€ã§ã™ã€‚<br>
                éºç‰©ã‚’å¾©å…ƒã—ã¦å±•ç¤ºã™ã‚‹ã¨ã€<b>å…¨ä½“åç›Šãƒœãƒ¼ãƒŠã‚¹</b>ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚
            </p>
            <button class="gacha-btn" id="btn-gacha" onclick="buyArtifact()">
                â›ï¸ éºç‰©ã®ç™ºæ˜ãƒ»å¾©å…ƒã‚’è©¦ã¿ã‚‹
                <span class="gacha-cost" id="gacha-price"></span>
            </button>
        </div>
    </div>
    <div id="sns-modal" class="modal" onclick="closeModalByBg(event, 'sns-modal')">
        <div class="sns-container">
            <div class="sns-header">
                <span style="font-weight:900; color:var(--neon-blue);">ğŸ“± Midnight Talk</span>
                <span style="font-size:12px; color:#666;">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </span>
            </div>
            <div id="sns-feed" class="sns-feed"></div>
        </div>
    </div>
    <div id="ach-modal" class="modal" onclick="closeModalByBg(event, 'ach-modal')">
        <h2 style="color:var(--gold);">ğŸ† éš ã—å®Ÿç¸¾</h2>
        <div id="ach-grid" class="ach-grid" onclick="event.stopPropagation()"></div>
    </div>
    <div id="help-modal" class="modal" onclick="closeModalByBg(event, 'help-modal')">
        <div onclick="event.stopPropagation()" style="background:var(--card); padding:30px; border-radius:20px; border:1px solid var(--border); text-align:center; min-width: 300px;">
            <h2 style="color:var(--gold)">ğŸ  è¨­å®šï¼†ã‚¬ã‚¤ãƒ‰</h2>
            <p style="font-size:15px; line-height:1.8; color:#ccc; margin-bottom: 20px;">
                1. <b>ğŸº éºç‰©åšç‰©é¤¨</b>ã§éºç‰©ã‚’å¾©å…ƒã—ã€åç›Šã‚’ãƒ–ãƒ¼ã‚¹ãƒˆã•ã›ã¾ã—ã‚‡ã†ã€‚<br>
                2. <b>ğŸ“± ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ãƒˆãƒ¼ã‚¯</b>ã§ä½æ°‘ãŸã¡ã®æœ¬éŸ³ã‚’è¦—ãè¦‹ã—ã¾ã—ã‚‡ã†ã€‚<br>
                3. æœ€å¾Œã®<b>ãƒ¦ãƒ¼ãƒˆãƒ”ã‚¢ãƒ»ãƒ©ãƒ³ã‚¯</b>ã«åˆ°é”ã™ã‚Œã°ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã§ã™ï¼
            </p>
            
            <button onclick="resetGame()" style="background:var(--danger); color:#fff; border:none; padding:12px 20px; border-radius:12px; font-weight:900; cursor:pointer; font-size:14px; box-shadow:0 0 10px rgba(255, 85, 85, 0.3); width: 100%;">
                âš ï¸ ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ– (æœ€åˆã‹ã‚‰)
            </button>
        </div>
    </div>
</div>

<script>
    // 3. ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
    const state = {
        money: 0, clickPower: 1, autoIncome: 1, 
        upgrades: [], history: [], artifacts: Array(20).fill(false),
        rank: 1, currentSelectedRank: 1, totalUniquePurchased: 0,
        residents: [], achievements: [], endingSeen: false
    };

    // 5. ê²Œì„ ë°ì´í„° ë° ë¡œì§ (ì¼ë³¸ì–´ ë²ˆì—­ë¨)
    // ğŸ› ï¸ [ìˆ˜ì •] í‚¤ê°’ì„ ëª¨ë‘ ì¼ë³¸ì–´ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤!
    const jobEmojis = {
        "ç”»å®¶": "ğŸ¨", "å°èª¬å®¶": "âœï¸", "æ•™æˆ": "ğŸ“š", "ãƒªãƒ‘ãƒ¼ãƒ‰ã‚¯": "ğŸ› ï¸",
        "ASMR DJ": "ğŸ§", "ãƒ¢ãƒ‡ãƒ«": "ğŸ‘ ", "åˆ‘äº‹": "ğŸ•µï¸", "ãƒãƒƒãƒˆãƒ©ãƒ³ãƒŠãƒ¼": "ğŸ’»",
        "ãƒ©ãƒ¼ãƒ¡ãƒ³å±‹": "ğŸœ", "æ¸©æ³‰ä¸»äºº": "â™¨ï¸", "ãƒãƒ¼ãƒã‚¹ã‚¿ãƒ¼": "ğŸ’¿",
        "ãƒŸãƒ¥ãƒ¼ã‚¸ã‚·ãƒ£ãƒ³": "ğŸ¸", "çŒ«": "ğŸ±", "VIP": "ğŸ‘‘"
    };

    const jobsData = {
        "ç”»å®¶": { 'Solo': ["ãƒã‚ªãƒ³ã®çµµã®å…·ãŒãµã‚ãµã‚ã—ã¦ã‚‹ã€‚", "ã“ã®è‰²å½©ã¯å›ã«ä¼¼ã¦ã„ã‚‹ã­ã€‚", "ç­†å…ˆã‹ã‚‰å¤œæ˜ã‘ãŒå’²ãã‚ˆã€‚", "ã‚­ãƒ£ãƒ³ãƒã‚¹ã¯ã¾ã æœªå®Œæˆã ã€‚"], 'Love': ["å›ã®ç³ã®è‰²ã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«è¾¼ã‚ãŸã„ã€‚", "å›ã¨ã„ã‚‹ã¨ä¸–ç•ŒãŒè›å…‰è‰²ã«è¦‹ãˆã‚‹ã‚ˆã€‚", "æœ€ã‚‚å®Œç’§ãªè‰²ã¯å›ã ã€‚"], 'Affair': ["ç§˜å¯†ã‚ã„ãŸè‰²ã¯é­…æƒ‘çš„ã ã­ã€‚", "ç¦ã˜ã‚‰ã‚ŒãŸç·šã‚’è¶Šãˆã‚‹ã®ã¯ã‚¹ãƒªãƒ«ãŒã‚ã‚‹ã€‚", "ã“ã£ãã‚Šæãå›ã®è‚–åƒç”»ãŒå¥½ãã ã€‚"], 'Stress': ["ç­†ã‚’ã¸ã—æŠ˜ã£ã¦ã—ã¾ã„ãŸã„ï¼", "ä½•ã‚‚æããŸããªã„ã€‚", "ä¸–ç•ŒãŒã™ã¹ã¦ç°è‰²ã ã€‚"] },
        "å°èª¬å®¶": { 'Solo': ["æ–‡ç« ãŸã¡ãŒè¸Šã£ã¦ã„ã‚‹ã€‚", "ã“ã®è¡—ã®ã™ã¹ã¦ãŒå°èª¬ã®ãƒã‚¿ã ã€‚", "ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¯ã©ã†ã—ã‚ˆã†ã‹ãªï¼Ÿ"], 'Love': ["å›ã¨ã®æ‹ã¯ãƒ™ã‚¹ãƒˆã‚»ãƒ©ãƒ¼ã ã€‚", "ç§ã®å°èª¬ã®ä¸»äººå…¬ã¯å›ã ã‚ˆã€‚", "ãƒãƒƒãƒ”ãƒ¼ã‚¨ãƒ³ãƒ‰ã ã‘ã‚’æ›¸ããŸã„ã€‚"], 'Affair': ["ç¦æ­¢ã•ã‚ŒãŸãƒãƒ£ãƒ—ã‚¿ãƒ¼ã‚’æ›¸ãæ°—åˆ†ã ã€‚", "èª­è€…ã¯çŸ¥ã‚‰ãªã„ç§ãŸã¡ã ã‘ã®ã©ã‚“ã§ã‚“è¿”ã—ã€‚", "å±é™ºãªä¼ç·šã®ã‚ˆã†ã«å›ã«æƒ¹ã‹ã‚Œã‚‹ã€‚"], 'Stress': ["æ–‡å­—ãŒè™«ã¿ãŸã„ã«è¦‹ãˆã‚‹ï¼", "åŸç¨¿ç”¨ç´™ã‚’å…¨éƒ¨ç‡ƒã‚„ã—ã¦ã‚„ã‚‹ï¼", "ç§ã®äººç”Ÿã¯å¤±æ•—ä½œã ã€‚"] },
        "æ•™æˆ": { 'Solo': ["æ­´å²ã¯ç¹°ã‚Šè¿”ã™ã€‚", "å¤ã„æœ¬ã®åŒ‚ã„ãŒå¥½ãã ã€‚", "2026å¹´ã¯å®Ÿã«ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ã ã£ãŸãªã€‚"], 'Love': ["å›ã¯æ­´å²ä¸Šã€æœ€ã‚‚ç¾ã—ã„ã€‚", "å›ã‚’ä¸€ç”Ÿç ”ç©¶ã—ãŸã„ã€‚", "å¤å…¸ã®è©©ã‚ˆã‚Šå›ã®æ–¹ãŒå„ªé›…ã ã€‚"], 'Affair': ["ç¦ã˜ã‚‰ã‚ŒãŸæ­´å²ã»ã©èˆˆå‘³æ·±ã„ãªã€‚", "é“å¾³çš„å°ºåº¦ã‚ˆã‚Šå›ãŒå¤§äº‹ã ã€‚", "ã“ã‚Œã¯ç§˜å¯†ã®æˆæ¥­ã ã‚ˆã€‚"], 'Stress': ["ãƒ‡ãƒ¼ã‚¿ã®å±‘ã©ã‚‚ã‚ï¼é™ã‹ã«ã—ã‚ï¼", "çŸ¥è­˜ãªã‚“ã¦å…¨éƒ¨å½¹ç«‹ãŸãšã ã€‚", "æœ¬ã‚’å…¨éƒ¨ç ´ã‚Šæ¨ã¦ãŸã„æ°—åˆ†ã ã€‚"] },
        "ãƒªãƒ‘ãƒ¼ãƒ‰ã‚¯": { 'Solo': ["æ©Ÿæ¢°ã¯å˜˜ã‚’ã¤ã‹ãªã„ã€‚", "ã©ã“ã‹æ•…éšœã—ãŸã¨ã“ã‚ã¯ãªã„ã‹ï¼Ÿ", "ã‚ªã‚¤ãƒ«ã®åŒ‚ã„ãŒé¦™ã°ã—ã„ãªã€‚"], 'Love': ["ä¿ºã®å¿ƒè‡“ã‚¨ãƒ³ã‚¸ãƒ³ã¯å›ã®ãŸã‚ã«å›ã£ã¦ã‚‹ã€‚", "å›ã®ãŸã‚ã«æœ€é«˜ã®ãƒ‘ãƒ¼ãƒ„ã‚’ç”¨æ„ã—ãŸã€‚", "å›ãŒã„ãªã‘ã‚Œã°ä¿ºã¯ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã ã€‚"], 'Affair': ["ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’è¿‚å›ã—ãŸã€‚", "å±é™ºãªã‚ªãƒ¼ãƒãƒ¼ã‚¯ãƒ­ãƒƒã‚¯ä¸­ã ã€‚", "ã‚·ãƒ§ãƒ¼ãƒˆã—ãã†ãªãã‚‰ã„ç—ºã‚Œã‚‹ãœã€‚"], 'Stress': ["å…¨éƒ¨ã‚¹ã‚¯ãƒ©ãƒƒãƒ—å ´ã«æ¨ã¦ã¦ã—ã¾ãˆï¼", "ç«èŠ±ãŒæ•£ã£ã¦ã‚‹ï¼ä¿ºã®é ­ã‚‚ã ï¼", "ã‚¯ã‚½ãƒƒãŸã‚Œãªé‰„å±‘ã©ã‚‚ã‚ã€‚"] },
        "ASMR DJ": { 'Solo': ["é›¨éŸ³ã‚’èã‹ã›ã¦ã‚ã’ã‚ˆã†ã‹ï¼Ÿ", "ãƒ†ã‚£ãƒ³ã‚°ãƒ«ã‚’æ„Ÿã˜ã‚‹ï¼Ÿ", "ä»Šå¤œã¯ç§ã®å£°ã¨ä¸€ç·’ã«éã”ã—ã¦ã€‚"], 'Love': ["å›ã«ã ã‘èã‹ã›ã‚‹å›ãã ã‚ˆã€‚", "å›ã®å¯æ¯ãŒæœ€é«˜ã®ASMRã ã­ã€‚", "ç§ãŸã¡ã®å‘¨æ³¢æ•°ã¯ä¸€è‡´ã—ã¦ã‚‹ã€‚"], 'Affair': ["ãƒã‚¤ã‚¯ã‚’åˆ‡ã£ã¦ç§˜å¯†ã®è©±ã‚’ã—ã‚ˆã†ã‹ï¼Ÿ", "æ”¾é€äº‹æ•…ã¿ãŸã„ãªæ‹ã ã­ã€‚", "ä»–äººã«ã¯èã“ãˆãªã„ã‚·ã‚°ãƒŠãƒ«ã€‚"], 'Stress': ["å«ã³ã ã—ãŸã„ï¼", "è€³é³´ã‚ŠãŒã—ã¦è¾›ã„ã€‚", "ã™ã¹ã¦ã®é¨’éŸ³ãŒæã‚ã—ã„ã‚ã€‚"] },
        "ãƒ¢ãƒ‡ãƒ«": { 'Solo': ["ä»Šæ—¥ã®ã‚¯ãƒ­ãƒ¼ãƒ ã®å…‰æ²¢ã€å®Œç’§ï¼Ÿ", "ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã®æ´—ç¤¼ã¯é£½ãé£½ãã€‚", "ã“ã®é€šã‚Šã¯ç§ã®ãƒ©ãƒ³ã‚¦ã‚§ã‚¤ã‚ˆã€‚"], 'Love': ["ç§ã‚ˆã‚Šå›ã®æ–¹ãŒè¼ã„ã¦ã‚‹ã€‚", "ç§ãŸã¡ã®ãƒ„ãƒ¼ã‚·ãƒ§ãƒƒãƒˆã¯ç”»å ±ãã®ã‚‚ã®ã‚ˆã€‚", "å›ã ã‘ã®ãƒŸãƒ¥ãƒ¼ã‚ºã«ãªã‚‹ã‚ã€‚"], 'Affair': ["ã‚¹ã‚­ãƒ£ãƒ³ãƒ€ãƒ«ï¼Ÿé–¢ä¿‚ãªã„ã‚ã€‚", "ã‚«ãƒ¡ãƒ©ã®è£ã§ä¼šã†ã®ãŒå¥½ããªã®ã€‚", "å±é™ºãªã»ã©ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ã§ã—ã‚‡ã€‚"], 'Stress': ["ç§ã®é¡”ã‚’è¦‹ãªã„ã§ï¼", "ç…§æ˜ã‚’å…¨éƒ¨æ¶ˆã—ã¦ï¼", "ã¿ã‚“ãªç§ã‚’è¦‹ã‹ã‘ã ã‘ã§åˆ¤æ–­ã™ã‚‹ã®ã­ã€‚"] },
        "åˆ‘äº‹": { 'Solo': ["é›¨ã®é™ã‚‹é€šã‚Šã¯è¨¼æ‹ ã‚’éš ã™ãªã€‚", "åˆæˆã‚¿ãƒã‚³ã®ç…™ãŒç›®ã«æŸ“ã¿ã‚‹ã€‚", "ç›´æ„ŸãŒæ¥ãŸãã€‚"], 'Love': ["ãŠå‰ã¯ä¿ºãŒæ¢ã—ã¦ã„ãŸæœ€å¾Œã®ãƒ‘ã‚ºãƒ«ã ã€‚", "ãŠå‰ãŒçŠ¯äººãªã‚‰é€®æ•ã•ã‚Œã¦ã‚„ã‚‹ã€‚", "ä¿ºã®éŠƒå£ã¯ãŠå‰ã‚’å®ˆã‚‹ãŸã‚ã ã‘ã«å‘ãã€‚"], 'Affair': ["å¼µã‚Šè¾¼ã¿ã‚’è¨€ã„è¨³ã«ã—ã¦å‡ºã¦ããŸã€‚", "ã“ã®é–¢ä¿‚ã¯ãƒˆãƒƒãƒ—ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã ã€‚", "è¨¼æ‹ ã‚’æ®‹ã™ãªã‚ˆã€‚"], 'Stress': ["ã“ã®è¡—ã¯è…ã£ã¦ã‚‹ã€‚", "çŠ¯äººã‚‚æ­£ç¾©ã‚‚å…¨éƒ¨ã†ã‚“ã–ã‚Šã ã€‚", "é ­ãŒå‰²ã‚Œãã†ã ã€‚"] },
        "ãƒãƒƒãƒˆãƒ©ãƒ³ãƒŠãƒ¼": { 'Solo': ["ã‚¢ã‚¤ã‚¹ï¼ˆé˜²å£ï¼‰ã‚’ç ´ã‚‹ãªã‚“ã¦æœé£¯å‰ã•ã€‚", "ç¾å®Ÿã‚ˆã‚Šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒæ¥½ã ã­ã€‚", "ãƒ‡ãƒ¼ã‚¿ã®æµã‚ŒãŒç¾ã—ã„ã€‚"], 'Love': ["å›ã®è„³ã¨åŒæœŸï¼ˆã‚·ãƒ³ã‚¯ãƒ­ï¼‰ã—ãŸã„ã€‚", "åƒ•ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’è§£é™¤ã§ãã‚‹å”¯ä¸€ã®äººã€‚", "å›ã¯åƒ•ã®æœ€é«˜ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã ã€‚"], 'Affair': ["ãƒãƒƒã‚¯ãƒ‰ã‚¢ã‹ã‚‰ã“ã£ãã‚Šæ¥ç¶šã—ãŸã‚ˆã€‚", "ãƒ­ã‚°ã¯å…¨éƒ¨å‰Šé™¤ã—ã¦ãŠãã­ã€‚", "ã‚¦ã‚¤ãƒ«ã‚¹ã®ç”¨ã§è‡´å‘½çš„ã ã€‚"], 'Stress': ["è„³ãŒç„¼ã‘ç„¦ã’ãã†ã ï¼", "æ¥ç¶šã‚’åˆ‡ã‚Œï¼å¼·åˆ¶ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼", "ãƒã‚¤ã‚ºã®ã›ã„ã§æ°—ãŒç‹‚ã„ãã†ã ã€‚"] },
        "ãƒ©ãƒ¼ãƒ¡ãƒ³å±‹": { 'Solo': ["ã‚¹ãƒ¼ãƒ—ãŒç…®ãˆã‚‹åŒ‚ã„ã€æœ€é«˜ã ã‚ï¼Ÿ", "æ¸©ã‹ã„ã‚¹ãƒ¼ãƒ—ä¸€æ¯ã‚„ã£ã¦ã„ããªã€‚", "ä»Šæ—¥ã‚‚ãŠå®¢ã•ã‚“ãŒå¤šã„ã­ã€‚"], 'Love': ["ã‚ã‚“ãŸã«ã¯ãƒãƒ£ãƒ¼ã‚·ãƒ¥ãƒ¼é£Ÿã¹æ”¾é¡Œã ã‚ˆã€‚", "ã‚¹ãƒ¼ãƒ—ã‚ˆã‚Šã‚ã‚“ãŸã®å¿ƒã®æ–¹ãŒæ¸©ã‹ã„ã­ã€‚", "ä¸€ç”Ÿãƒ©ãƒ¼ãƒ¡ãƒ³ä½œã£ã¦ã‚ã’ã‚‹ã‚ˆã€‚"], 'Affair': ["ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚’ä¸‹ã‚ã—ã¦ã“ã£ãã‚Šä¼šãŠã†ã‹ï¼Ÿ", "æ¿€è¾›ã‚ˆã‚Šãƒ›ãƒƒãƒˆã ã­ã€‚", "ã‚¹ãƒ¼ãƒ—ãŒå†·ã‚ã‚‹å‰ã«æ—©ããŠã„ã§ã€‚"], 'Stress': ["ã‚¹ãƒ¼ãƒ—ã‚’ã²ã£ãã‚Šè¿”ã—ãŸã„ã€‚", "å®¢ã©ã‚‚å…¨å“¡å‡ºã¦è¡Œã‘ã¨è¨€ãˆï¼", "éººãŒå…¨éƒ¨ä¼¸ã³ã¡ã¾ã£ãŸã€‚"] },
        "æ¸©æ³‰ä¸»äºº": { 'Solo': ["ãŠæ¹¯ã®æ¸©åº¦ãŒã¡ã‚‡ã†ã©ã„ã„ã‚ˆã€‚", "ç–²ã‚ŒãŒã™ã£ãã‚Šå–ã‚Œã‚‹ã¯ãšã•ã€‚", "ç¡«é»„ã®åŒ‚ã„ã€æ…£ã‚Œã‚Œã°ã„ã„ã‚‚ã‚“ã ã‚ˆã€‚"], 'Love': ["å›ã¨æ··æµ´â€¦ãªã‚“ã¦ã€å†—è«‡ã ã‚ˆã€‚", "ç§ã®å¿ƒã‚‚æ¸©æ³‰ã¿ãŸã„ã«ç†±ã„ã‚ˆã€‚", "å›ã¯ç§ã®æ¸©æ³‰ã®èŠ±ã ã€‚"], 'Affair': ["è„±è¡£æ‰€ã®è£ã§ä¼šãŠã†ã€‚", "æ¹¿æ°—ã®ã›ã„ã§é¡”ãŒèµ¤ããªã£ãŸã­ã€‚", "å±é™ºãªæ¸©åº¦ã«ãªã£ã¦ã‚‹ã‚ˆã€‚"], 'Stress': ["ãŠæ¹¯ã‚’å…¨éƒ¨æŠœã„ã¦ã—ã¾ãˆï¼", "å®¢ãŒã†ã‚‹ã•ã™ãã‚‹ã€‚", "ã®ã¼ã›ã¦ç›®ãŒå›ã‚Šãã†ã ã€‚"] },
        "ãƒãƒ¼ãƒã‚¹ã‚¿ãƒ¼": { 'Solo': ["ã“ã®æ›²ã¯20ä¸–ç´€ã®åæ›²ã•ã€‚", "ã‚¸ãƒ£ã‚ºãŒæµã‚Œã‚‹å¤œã ã­ã€‚", "ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ä¸€æ¯ã©ã†ï¼Ÿ"], 'Love': ["ã“ã®æ­Œã¯å›ã®ãŸã‚ã®ã‚‚ã®ã ã€‚", "å›ã®å£°ãŒæœ€é«˜ã®éŸ³æ¥½ã ã‚ˆã€‚", "åƒ•ã‚‰ã®æ„›ã‚’ãƒ¬ã‚³ãƒ¼ãƒ‰ã«åˆ»ã¿ãŸã„ã­ã€‚"], 'Affair': ["åº—ã®éµã‚’é–‰ã‚ã¦å§‹ã‚ã‚ˆã†ã‹ï¼Ÿ", "ç§˜å¯†ã‚ã„ãŸãƒªã‚ºãƒ ã«ä¹—ã£ã¦ã¿ã‚ˆã†ã€‚", "ç¦æ­¢ã•ã‚ŒãŸæ›²ã‚’ã‹ã‘ã‚‹æ°—åˆ†ã ã€‚"], 'Stress': ["éŸ³æ¥½ã‚’æ¶ˆã›ï¼é™ã‹ã«ã—ã‚ï¼", "é…’ç“¶ã‚’å…¨éƒ¨å‰²ã‚ŠãŸã„æ°—åˆ†ã ã€‚", "ã“ã‚“ãªå®‰ã£ã½ã„éŸ³æ¥½ã¯ã‹ã‘ãªã„ãã€‚"] },
        "ãƒŸãƒ¥ãƒ¼ã‚¸ã‚·ãƒ£ãƒ³": { 'Solo': ["æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒæµ®ã‹ã‚“ã ã€‚", "ä¿ºã®ã‚®ã‚¿ãƒ¼ã‚½ãƒ­ã©ã†ï¼Ÿ", "ã“ã®è¡—ã¯ä¿ºã®ã‚¹ãƒ†ãƒ¼ã‚¸ã ã€‚"], 'Love': ["å›ã®ãŸã‚ã®ã‚»ãƒ¬ãƒŠãƒ¼ãƒ‡ã‚’ä½œã£ãŸã‚ˆã€‚", "å›ã®å¿ƒè‡“ã®é¼“å‹•ã«ãƒ†ãƒ³ãƒã‚’åˆã‚ã›ã‚‹ã€‚", "å›ã¯ä¿ºã®ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æºã ã€‚"], 'Affair': ["ãƒãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã“ã£ãã‚Šä¼šãŠã†ã€‚", "ã“ã‚Œã¯ã‚¢ãƒ³ã‚³ãƒ¼ãƒ«ã®ãªã„å…¬æ¼”ã ã€‚", "å±é™ºãªãƒ­ãƒƒã‚¯ãƒ³ãƒ­ãƒ¼ãƒ«ã ãœã€‚"], 'Stress': ["ã‚®ã‚¿ãƒ¼ã®å¼¦ã‚’å…¨éƒ¨åˆ‡ã£ã¡ã¾ã£ãŸã€‚", "æ¥½æƒ³ãŒæµ®ã‹ã°ãªã„ï¼", "ã¿ã‚“ãªä¿ºã®éŸ³æ¥½ã‚’ä¾®è¾±ã—ã¦ã‚‹ã€‚"] },
        "çŒ«": { 'Solo': ["ãƒ‹ãƒ£ãƒ¼ã€‚ï¼ˆé£¯ãã‚Œã€‚ï¼‰", "ã‚´ãƒ­ã‚´ãƒ­â€¦ï¼ˆæº€è¶³ï¼‰", "é¦™ç®±åº§ã‚Šä¸­ã ã‚ˆã€‚", "é«˜ã„ã¨ã“ã‚ãŒå¥½ãã€‚", "æ®µãƒœãƒ¼ãƒ«ã ï¼ç§ã®ã‚‚ã®ã€‚"], 'Love': ["ãƒ‹ãƒ£ï½ã‚ªï¼ˆå›ã«ã‚¹ãƒªã‚¹ãƒªï¼‰", "ã‚´ãƒ­ã‚´ãƒ­ã‚½ãƒ³ã‚°æ­Œã£ã¦ã‚‹æœ€ä¸­ã ã‚ˆã€‚", "å›ã®ãŠè…¹ã®ä¸ŠãŒä¸€ç•ªæš–ã‹ã„ã€‚", "ãƒ•ãƒŸãƒ•ãƒŸã—ã¦ã‚ã’ã‚‹ã€‚"], 'Affair': ["ã‚·ãƒ£ãƒ¼ãƒƒï¼ï¼ˆä»–ã®ä¸‹åƒ•ã®åŒ‚ã„ãŒã™ã‚‹ï¼ï¼‰", "ã“ã£ãã‚Šå¤œéŠã³ã—ã¦ãã‚‹ãƒ‹ãƒ£ã€‚", "ã“ã£ãã‚Šãƒãƒ¥ãƒ¼ãƒ«ç›—ã¿é£Ÿã„ã—ãŸã€‚", "ç§˜å¯†ã®å‹é”ãŒã§ããŸãƒ‹ãƒ£ã€‚"], 'Stress': ["ãƒ•ã‚¬ãƒ¼ãƒƒï¼ï¼ï¼ˆè§¦ã‚‹ãªï¼ï¼‰", "ã‚·ãƒ£ãƒ¼ãƒƒï¼ï¼ˆã‚ã£ã¡è¡Œã‘ï¼ï¼‰", "å°»å°¾ãƒœãƒ³ï¼æ¯›ãŒé€†ç«‹ã¤ï¼", "çˆªã§å…¨éƒ¨å¼•ã£æ»ã„ã¦ã‚„ã‚‹ï¼"] },
        "VIP": { 'Solo': ["ã„ãã‚‰ã ï¼Ÿå…¨éƒ¨è²·ã„å ã‚ã¦ã‚„ã‚‹ã€‚", "ã“ã“ãŒãƒšãƒ³ãƒˆãƒã‚¦ã‚¹ã‹ï¼Ÿ", "ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³ã‚’æŒã£ã¦ã“ã„ã€‚", "æ™¯è‰²ã¯ãªã‹ãªã‹æ‚ªããªã„ãªã€‚"], 'Love': ["ã“ã®è¡—ã‚’å›ã«ã‚ã’ã‚ˆã†ã€‚", "ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã‚ˆã‚Šå›ãŒè¼ã„ã¦ã„ã‚‹ã€‚", "ç§ã®è²¡ç”£ç›®éŒ²1å·ã¯å›ã ã€‚"], 'Affair': ["ç§˜å¯†ã®å¥‘ç´„æ›¸ã«ã‚µã‚¤ãƒ³ã—ã‚ã€‚", "ãƒ›ãƒ†ãƒ«ã®ã‚¹ã‚¤ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ ã‚’å–ã£ã¦ãŠã„ãŸã€‚", "é‡‘ã§ã¯è²·ãˆãªã„ã‚¹ãƒªãƒ«ã ãªã€‚"], 'Stress': ["å…¨å“¡ã‚¯ãƒ“ã«ã—ã‚ï¼é–“æŠœã‘ã©ã‚‚ã‚ï¼", "ç§ã®æ ªãŒæš´è½ã—ãŸï¼", "ã‚µãƒ¼ãƒ“ã‚¹ãŒæœ€æ‚ªã ã€‚è¨´ãˆã¦ã‚„ã‚‹ï¼"] }
    };

    const artifactsData = [
        { name: "æ—§å‹iPhone", emoji: "ğŸ“±", desc: "2026å¹´ã€äººé¡ãŒè¦ªæŒ‡ã§ä¸–ç•Œã‚’æ”¯é…ã—ã¦ã„ãŸé­”æ³•ã®é“å…·ã€‚" },
        { name: "ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¤ãƒ¤ãƒ›ãƒ³", emoji: "ğŸ«›", desc: "è±†ã®ã‚ˆã†ãªå½¢ã‚’ã—ã¦ãŠã‚Šã€å¤ä»£äººã¯ã“ã‚Œã‚’è€³ã«æŒ¿ã—ã¦ä¿¡å·ã‚’å—ä¿¡ã—ãŸã€‚" },
        { name: "å®Ÿç‰©ã‚«ãƒ¼ãƒ‰", emoji: "ğŸ’³", desc: "ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã®æ¬ ç‰‡ä¸€ã¤ã§ã™ã¹ã¦ã®ä¾¡å€¤ã‚’äº¤æ›ã—ã¦ã„ãŸæ™‚ä»£ã®ç”£ç‰©ã€‚" },
        { name: "ã‚«ãƒƒãƒ—éººã®å®¹å™¨", emoji: "ğŸœ", desc: "3åˆ†ã§ç¥ã€…ã®é£Ÿã¹ç‰©ã‚’éŒ¬æˆã—ã¦ã„ãŸå¤ä»£ã®éŒ¬é‡‘è¡“å®¹å™¨ã€‚" },
        { name: "æœ‰ç·šãƒã‚¦ã‚¹", emoji: "ğŸ–±ï¸", desc: "å°»å°¾ãŒã¤ã„ãŸãƒã‚ºãƒŸå‹ã®è£…ç½®ã€‚2202å¹´ã«ã¯è„³æ³¢ãŒä»£ã‚ã‚Šã‚’å‹™ã‚ã‚‹ã€‚" },
        { name: "ç´™å¹£ã®æŸ", emoji: "ğŸ’µ", desc: "ç´™åˆ‡ã‚Œã«ä¾¡å€¤ã‚’ä¸ãˆã¦ã„ãŸäººé¡ã®é›†å›£çš„ä¿¡ä»°ã®è¨¼æ‹ ã€‚" },
        { name: "ç´™ã®æœ¬", emoji: "ğŸ“–", desc: "ãƒ‡ãƒ¼ã‚¿ã§ã¯ãªãã€å®Ÿéš›ã®æœ¨ã‚’è–„ãåˆ‡ã£ã¦æƒ…å ±ã‚’è¨˜éŒ²ã—ã¦ã„ãŸãƒ­ãƒãƒ³ã€‚" },
        { name: "çœ¼é¡", emoji: "ğŸ‘“", desc: "è¦–è¦šãƒ‡ãƒ¼ã‚¿ã‚’çŸ¯æ­£ã™ã‚‹ãŸã‚ã«é¡”ã«æ›ã‘ã¦ã„ãŸç‰©ç†çš„è£œæ­£è£…ç½®ã€‚" },
        { name: "éµæŸ", emoji: "ğŸ”‘", desc: "ç‰©ç†çš„ãªãƒ‰ã‚¢ã‚’é–‹ã‘ã‚‹ãŸã‚ã«æŒã¡æ­©ã„ã¦ã„ãŸé‰„ã®æ¬ ç‰‡ãŸã¡ã€‚" },
        { name: "æ—§å‹ã‚²ãƒ¼ãƒ æ©Ÿ", emoji: "ğŸ®", desc: "2026å¹´ã®äººã€…ãŒä»®æƒ³ä¸–ç•Œã¸é€ƒé¿ã—ã¦ã„ãŸå°ã•ãªçª“å£ã€‚" },
        { name: "å¤ã„ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ‡ã‚£ã‚¹ã‚¯", emoji: "ğŸ’¿", desc: "2026å¹´ã€éŸ³æ¥½ã‚’ç‰©ç†çš„ã«è¨˜éŒ²ã—ã¦ã„ãŸè¼ãå††ç›¤ã€‚" },
        { name: "ã‚¢ãƒŠãƒ­ã‚°ç½®ãæ™‚è¨ˆ", emoji: "â°", desc: "é‡ãŒå‹•ãã€ç‰©ç†çš„ã«æ™‚é–“ã‚’æŒ‡ã—ç¤ºã—ã¦ã„ãŸæ©Ÿæ¢°ã€‚" },
        { name: "æ‰‹å‹•ãƒãƒƒãƒç®±", emoji: "ğŸ•¯ï¸", desc: "æ‘©æ“¦ã‚’é€šã˜ã¦ç«èŠ±ã‚’ä½œã‚Šå‡ºã—ã¦ã„ãŸ2026å¹´ã®åŸå§‹çš„ãªé“å…·ã€‚" },
        { name: "ä½¿ã„æ¨ã¦ãƒ•ã‚£ãƒ«ãƒ ã‚«ãƒ¡ãƒ©", emoji: "ğŸ“¸", desc: "çµæœã‚’å³åº§ã«ç¢ºèªã§ããªã„ã‹ã‚‰ã“ãã€ã‚ˆã‚Šå¤§åˆ‡ã ã£ãŸè¨˜éŒ²æ©Ÿã€‚" },
        { name: "USBãƒ¡ãƒ¢ãƒªãƒãƒƒãƒ—", emoji: "ğŸ’¾", desc: "ãƒ‡ãƒ¼ã‚¿ã‚’ç‰©ç†çš„ãªæ¬ ç‰‡ã«å…¥ã‚Œã¦é‹ã‚“ã§ã„ãŸç…©ã‚ã—ã„æ™‚ä»£ã®ç”£ç‰©ã€‚" },
        { name: "é»„è‰²ã„ãƒã‚¹ãƒˆã‚¤ãƒƒãƒˆ", emoji: "ğŸ“", desc: "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¡ãƒ¢ã®ä»£ã‚ã‚Šã«ç´™ã«æ›¸ã„ã¦è²¼ã£ã¦ãŠã„ãŸå¤ä»£äººã®è¨˜éŒ²æ³•ã€‚" },
        { name: "é‰„è£½ã‚¹ãƒ†ãƒ¼ãƒ—ãƒ©ãƒ¼", emoji: "ğŸ–‡ï¸", desc: "ç´™ã®æŸã‚’ç‰©ç†çš„ã«å›ºå®šã—ã¦ã„ãŸå°ã•ãã¦å¼·ã„äº‹å‹™é“å…·ã€‚" },
        { name: "ç«¹ã®å›£æ‰‡", emoji: "ğŸª­", desc: "ç›´æ¥è…•ã‚’æŒ¯ã£ã¦é¢¨ã‚’ä½œã£ã¦ã„ãŸ2026å¹´ã®ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãªå†·æˆ¿è£…ç½®ã€‚" },
        { name: "é›»æ± å¼æ‡ä¸­é›»ç¯", emoji: "ğŸ”¦", desc: "é›»æ°—ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ç›´æ¥æºå¸¯ã—ã€é—‡ã‚’ç…§ã‚‰ã—ã¦ã„ãŸéºç‰©ã€‚" },
        { name: "500ã‚¦ã‚©ãƒ³ç¡¬è²¨", emoji: "ğŸª™", desc: "é‡‘å±ã®æ¬ ç‰‡ã«ä¾¡å€¤ã‚’è¾¼ã‚ã¦å–å¼•ã—ã¦ã„ãŸæ™‚ä»£ã®æœ€å¾Œã®è²¨å¹£ã®ä¸€ã¤ã€‚" }
    ];

    const uniqueInfra = [
        {n: "å¤ã³ãŸãƒã‚ªãƒ³ã‚µã‚¤ãƒ³ã®ä¿®ç†", h: false}, {n: "è¡—è§’ã®è‡ªè²©æ©Ÿè£œå……", h: false}, {n: "åˆæˆãƒ©ãƒ¼ãƒ¡ãƒ³å±‹å°", h: false},
        {n: "ãƒ“ãƒ³ãƒ†ãƒ¼ã‚¸ãƒ»ãƒ¬ã‚³ãƒ¼ãƒ‰åº—", h: false}, {n: "æ·±å¤œã®ä¸²ç„¼ãå±‹", h: false}, {n: "ç¥çµŒåŒæœŸã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼åº—", h: false},
        {n: "ã‚¨ãƒªã‚¢ãƒ™ãƒ¼ã‚«ãƒªãƒ¼ã€Œå¤œæ˜ã‘ã€", h: false}, {n: "é­‚ã®è¨˜æ†¶ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ‰€", h: false}, {n: "ãƒã‚ªãƒ³ãŸã“ç„¼ãéœ²åº—", h: false},
        {n: "ã‚°ãƒ­ãƒ¼ãƒ»ã‚¹ã‚¤ãƒ¼ãƒ„ãƒ—ãƒªãƒ³ãƒ»ã‚«ãƒ•ã‚§", h: true}, {n: "äººå·¥é›¨æµ„åŒ–è£…ç½®", h: false}, {n: "ãµã‚ãµã‚è€³æƒé™¤ã‚»ãƒ³ã‚¿ãƒ¼", h: true},
        {n: "ç„¡äººãƒ©ãƒ³ãƒ‰ãƒªãƒ¼ãƒ©ã‚¦ãƒ³ã‚¸", h: false}, {n: "ã‚µã‚¤ãƒãƒ¼ã‚¦ã‚§ã‚¢å°‚ç”¨ãƒãƒƒã‚µãƒ¼ã‚¸", h: true}, {n: "åˆæˆã‚·ãƒ¼ã‚·ãƒ£ï¼ˆæ°´ã‚¿ãƒã‚³ï¼‰ãƒ©ã‚¦ãƒ³ã‚¸", h: true},
        {n: "å°å‹ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰ä¿®ç†æ‰€", h: false}, {n: "æ·±å¤œã®åˆæˆè–¬å±€", h: false}, {n: "ãƒŠãƒã‚¿ãƒˆã‚¥ãƒ¼ãƒ»ã‚¢ãƒˆãƒªã‚¨", h: false},
        {n: "ãƒ”ã‚¢ã‚¹ï¼†ã‚¯ãƒ­ãƒ¼ãƒ ãƒ»ã‚«ã‚¹ã‚¿ãƒ åº—", h: false}, {n: "ã‚µã‚¤ãƒãƒ¼ç­‹è‚‰ç‰©ç†æ²»ç™‚å®¤", h: true}, {n: "ãƒã‚ªãƒ³ãƒ»ãƒ©ã‚¤ãƒ–ãƒã‚¦ã‚¹", h: false},
        {n: "ã‚¹ãƒˆãƒ¬ã‚¹è„³æ´—æµ„ã‚·ãƒ§ãƒƒãƒ—", h: true}, {n: "ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯ãƒ»ã‚¢ãƒ­ãƒã‚µã‚¦ãƒŠ", h: true}, {n: "ç¡çœ èª˜å°ASMRãƒ«ãƒ¼ãƒ ", h: true},
        {n: "ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆç‹¬ç«‹ã‚·ãƒãƒ", h: false}, {n: "ãƒã‚ªãƒ³å¤§è¡†æµ´å ´", h: false}, {n: "24æ™‚ã‚³ãƒ³ãƒ“ãƒ‹ã€Œãƒã‚ªãƒ³ã€", h: false},
        {n: "ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ—å¤æ›¸åº—", h: false}, {n: "ãƒ¬ãƒˆãƒ­ã‚²ãƒ¼ãƒ ã‚»ãƒ³ã‚¿ãƒ¼", h: false}, {n: "ã‚µã‚¤ãƒãƒ¼ã‚¦ã‚§ã‚¢ç²¾å¯†æ¤œè¨ºæ‰€", h: false},
        {n: "ç©ºé£›ã¶ãƒã‚¤ã‚¯ä¿‚ç•™æ‰€", h: false}, {n: "ãƒ›ãƒ­ã‚°ãƒ©ãƒ ãƒ»ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼åº—", h: false}, {n: "æ·±å¤œã®æ¼«ç”»å–«èŒ¶", h: true},
        {n: "ã‚¨ãƒªã‚¢ã®å°ã•ãªç¾è¡“é¤¨", h: true}, {n: "ç©ºä¸­åº­åœ’ãƒ†ã‚£ãƒ¼ãƒ«ãƒ¼ãƒ ", h: true}, {n: "ãƒã‚ªãƒ³ãƒ»ãƒ”ãƒ³ãƒœãƒ¼ãƒ«ã‚»ãƒ³ã‚¿ãƒ¼", h: false},
        {n: "ç©ºé£›ã¶è»Šå°‚ç”¨é§è»Šå ´", h: false}, {n: "ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒ­ãƒƒãƒˆãƒ»ã‚«ãƒ©ã‚ªã‚±", h: false}, {n: "VRãƒ†ãƒ¼ãƒãƒ»ãƒ«ãƒ¼ãƒ ", h: true},
        {n: "ã‚µã‚¤ãƒãƒ¼ãƒšãƒƒãƒˆç”¨å“åº—", h: true}, {n: "å¤©ç„¶åˆæˆæ¸©æ³‰ (Premium)", h: true}, {n: "ã‚¯ãƒ­ãƒ¼ãƒ å¸‚æ°‘å°‚ç”¨ä¼‘æ†©æ‰€ã€Œã‚µãƒ³ã‚¯ãƒãƒ¥ã‚¢ãƒªã€", h: true},
        {n: "ãƒã‚ªãƒ³ãƒ»ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚¯ãƒ©ãƒ–", h: false}, {n: "æ°´ä¸­ãƒãƒƒã‚µãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«", h: true}, {n: "çš®è†šå†ç”Ÿã‚¨ã‚¹ãƒ†", h: true},
        {n: "ãƒã‚¤ã‚ªé…¸ç´ ã‚«ãƒ—ã‚»ãƒ«", h: true}, {n: "ã‚­ãƒ£ãƒ³ãƒ‰ãƒ«ï¼†ãƒ‡ã‚£ãƒ•ãƒ¥ãƒ¼ã‚¶ãƒ¼å°‚é–€åº—", h: true}, {n: "è¨˜æ†¶ã®æ¬ ç‰‡ãƒ›ãƒ­ã‚°ãƒ©ãƒ åº—", h: true},
        {n: "ç‘æƒ³ï¼†ãƒ¨ã‚¬ã‚»ãƒ³ã‚¿ãƒ¼", h: true}, {n: "ç¡çœ è£œåŠ©å‰¤è–¬å±€", h: true}, {n: "åœ°ä¸‹è¡—ãƒ©ãƒ¼ãƒ¡ãƒ³ãƒ„ã‚¢ãƒ¼", h: false},
        {n: "ãƒ–ãƒ«ãƒ¼ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ãƒ»ãƒªã‚¾ãƒ¼ãƒˆ", h: true}, {n: "ã‚µã‚¤ãƒãƒ¼é¤ƒå­è·äºº", h: false}, {n: "æ·±å¤œã®ç‚¹å¿ƒå°‚é–€é¤¨", h: false},
        {n: "äººå·¥è‚‰ãƒãƒ¼ã‚¬ãƒ¼ãƒã‚¦ã‚¹", h: false}, {n: "ã‚³ãƒ†ãƒ¼ã‚¸ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚¬ã‚¸ãƒ³æ”¯éƒ¨", h: false}, {n: "ã‚³ã‚¤ãƒ³ãƒ©ãƒ³ãƒ‰ãƒªãƒ¼ï¼†ãƒ–ãƒƒã‚¯ã‚«ãƒ•ã‚§", h: true},
        {n: "è·¯åœ°è£ã®å¤ç€å±‹", h: false}, {n: "ãƒã‚ªãƒ³ã‚·ãƒ¥ãƒ¼ã‚ºãƒ»ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—", h: false}, {n: "ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒ•ãƒ©ãƒ¯ãƒ¼ã‚¬ãƒ¼ãƒ‡ãƒ³", h: true},
        {n: "çŸ¥èƒ½å‹é˜²çŠ¯ãƒ‰ãƒ­ãƒ¼ãƒ³ãƒãƒ–", h: false}, {n: "ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ã‚«ãƒ©ãƒ¼è¨ºæ–­å®¤", h: false}, {n: "ãƒã‚ªãƒ³ãƒ»ãƒã‚¤ãƒ«ã‚¢ãƒ¼ãƒˆãƒ»ã‚¢ãƒˆãƒªã‚¨", h: true},
        {n: "ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒ¡ã‚¤ã‚¯ã‚¢ãƒƒãƒ—ã‚»ãƒ³ã‚¿ãƒ¼", h: true}, {n: "é­‚ã®è¨˜æ†¶ã‚¯ãƒ©ã‚¦ãƒ‰ã‚»ãƒ³ã‚¿ãƒ¼", h: false}, {n: "ä¸­å¤ãƒ›ãƒãƒ¼ãƒã‚¤ã‚¯åº—", h: false},
        {n: "è‡ªå‹•é‹è»¢ã‚¿ã‚¯ã‚·ãƒ¼ä¹—ã‚Šå ´", h: false}, {n: "ã‚¨ãƒªã‚¢å…±æœ‰é§è»Šã‚¿ãƒ¯ãƒ¼", h: false}, {n: "é£›è¡Œèˆ¹ãƒ„ã‚¢ãƒ¼äºˆç´„å‡¦", h: false},
        {n: "éƒ½å¸‚çµ±åˆä¹—ã‚Šæ›ãˆã‚»ãƒ³ã‚¿ãƒ¼", h: false}, {n: "5ã¤æ˜Ÿãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ»ãƒ†ãƒƒã‚¯ãƒ›ãƒ†ãƒ«", h: true}, {n: "è‰²ã‚ã›ãŸã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ»ã‚¢ãƒ™ãƒ‹ãƒ¥ãƒ¼ãƒ»ãƒ—ãƒ©ã‚¶", h: true},
        {n: "ã‚¨ãƒãƒ«ã‚®ãƒ¼å›åç™ºé›»å›£åœ°", h: false}, {n: "æ°´è€•æ ½åŸ¹ãƒã‚ªãƒ³æ¸©å®¤", h: true}, {n: "åœ°ä¸­ç†±æš–æˆ¿ã‚·ã‚¹ãƒ†ãƒ ", h: false},
        {n: "ãƒã‚¤ã‚ªãƒŠãƒå†ç”Ÿã‚»ãƒ³ã‚¿ãƒ¼", h: true}, {n: "å¤§è¦æ¨¡ãƒã‚ªãƒ³ãƒ»ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ«", h: false}, {n: "ãƒ¡ã‚¬ãƒ»ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚«ãƒ³ãƒ‘ãƒ‹ãƒ¼", h: false},
        {n: "éƒ½å¸‚è¡€ç®¡ç‰©æµç¶²", h: false}, {n: "é«˜é«˜åº¦ãƒ‰ãƒ­ãƒ¼ãƒ³è£œçµ¦è·¯", h: false}, {n: "ãƒã‚¤ã‚ªã‚¨ãƒãƒ«ã‚®ãƒ¼æ¤ç‰©åœ’", h: true},
        {n: "ã‚³ãƒ†ãƒ¼ã‚¸ãƒ»ãƒã‚¤ãƒ³ãƒ‰ç®¡åˆ¶ã‚»ãƒ³ã‚¿ãƒ¼", h: false}, {n: "ãƒã‚¤ãƒ‘ãƒ¼ãƒ«ãƒ¼ãƒ—ãƒ»ã‚»ãƒ³ã‚¿ãƒ¼", h: false}, {n: "å®‡å®™èˆªç©ºã‚»ãƒ³ã‚¿ãƒ¼", h: false},
        {n: "ã‚³ãƒ†ãƒ¼ã‚¸ãƒ»ã‚¿ãƒ¯ãƒ¼å»ºè¨­", h: false}, {n: "å¤©ã®å·è¦³æ¸¬ã‚¿ãƒ¯ãƒ¼", h: false}, {n: "æ·±å¤œè¡›æ˜Ÿå‘¨æ³¢æ•°ä¼é€å±€", h: false},
        {n: "ç’°å¢ƒå›å¾©åŠ é€Ÿã‚»ãƒ³ã‚¿ãƒ¼", h: true}, {n: "è¨˜æ†¶ä¿ç®¡éŠ€è¡Œ", h: false}, {n: "äººé–“-æ©Ÿæ¢°å”åŠ›ã‚»ãƒ³ã‚¿ãƒ¼", h: false},
        {n: "ãƒ†ãƒ©ãƒ•ã‚©ãƒ¼ãƒŸãƒ³ã‚°ãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ãƒœ", h: true}, {n: "ã‚ªãƒ¡ã‚¬ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ç¶²", h: false}, {n: "ã‚¢ãƒ«ãƒ•ã‚¡ãƒ»ã‚·ãƒ†ã‚£æ¼”ç®—ã‚»ãƒ³ã‚¿ãƒ¼", h: false},
        {n: "æ–°ä¸–ç•Œã¸ã®é–¢é–€", h: false}, {n: "2026å¹´å¼ã‚¢ãƒŠãƒ­ã‚°æ—¥å·®ã—çª“", h: true}, {n: "å¤ã³ãŸå…±ç”¨é…¸ç´ å……é›»æ‰€", h: true},
        {n: "æ·±å¤œã®ãƒ†ã‚£ãƒ³ã‚°ãƒ«ASMRãƒ˜ã‚¢ã‚µãƒ­ãƒ³", h: true}, {n: "æ¼”åŠ‡ãŒçµ‚ã‚ã£ãŸå¾Œã®å°åŠ‡å ´", h: true}, {n: "ä½è»Œé“æµã‚Œæ˜Ÿèª˜å°è£…ç½®", h: false},
        {n: "ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ãƒ¦ãƒ¼ãƒˆãƒ”ã‚¢", h: true}
    ];

    const rankNames = ["ç´ æœ´ã§å±…å¿ƒåœ°ã®è‰¯ã„ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ã®éƒ¨å±‹", "ãƒã‚ªãƒ³ãƒ»ã‚¢ãƒˆãƒªã‚¨", "ä½œå®¶ã¨æ•™æˆã®æ›¸æ–", "ãƒªãƒ‘ãƒ¼ãƒ‰ã‚¯ã®æ•´å‚™æ‰€", "ãƒ©ã‚¸ã‚ªãƒ»ã‚¹ã‚¿ã‚¸ã‚ª", "ãƒ•ã‚©ãƒˆã‚°ãƒ©ãƒ•ã‚¡ãƒ¼ã®æš—å®¤", "åˆæˆãƒ©ãƒ¼ãƒ¡ãƒ³å±‹å°", "é›¨ã®é™ã‚‹ãƒ†ãƒ©ã‚¹", "ãƒ“ãƒ³ãƒ†ãƒ¼ã‚¸ãƒ»ãƒ¬ã‚³ãƒ¼ãƒ‰åº—", "å±‹ä¸Šã®åº­åœ’", "ã‚µã‚¦ãƒŠ", "ã‚¯ãƒ­ãƒ¼ãƒ æ¸©æ³‰å®¤", "LPãƒãƒ¼", "ãƒšãƒ³ãƒˆãƒã‚¦ã‚¹ã®æ™©é¤", "ãƒ¢ãƒ«ã‚½ãƒ•ãƒˆãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", "ãƒ‡ã‚£ã‚¹ãƒˆãƒªã‚¯ãƒˆãƒ»ã‚¯ã‚©ãƒ¼ã‚¿ãƒ¼", "ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒã‚¤ã‚¦ã‚§ã‚¤", "ã‚®ãƒ£ãƒ©ã‚¯ã‚·ãƒ¼ãƒ»ã‚·ãƒ†ã‚£", "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ»ã‚µãƒ³ã‚»ãƒƒãƒˆãƒ»ã‚·ãƒ†ã‚£", "ãƒ¦ãƒ¼ãƒˆãƒ”ã‚¢ãƒ»ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ã‚³ãƒ†ãƒ¼ã‚¸"];
    const rankImages = ["https://i.imgur.com/MuFQQ5A.png", "https://i.imgur.com/1nAnNIb.png", "https://i.imgur.com/eqwGBhl.png", "https://i.imgur.com/br0HdSG.png", "https://i.imgur.com/2Sz2iYA.png", "https://i.imgur.com/3qXyDTr.png", "https://i.imgur.com/J5mjTBn.png", "https://i.imgur.com/aI6UVY2.png", "https://i.imgur.com/QMSpzfL.png", "https://i.imgur.com/PwZ6vm3.png", "https://i.imgur.com/S4yBFXT.png", "https://i.imgur.com/A0HQ7e3.png", "https://i.imgur.com/qeB68bj.png", "https://i.imgur.com/RoQeLG8.png", "https://i.imgur.com/vuNzL4d.png", "https://i.imgur.com/P1SjHGR.png", "https://i.imgur.com/tApbEin.png", "https://i.imgur.com/ylCZJyn.png", "https://i.imgur.com/vA1hKCT.png", "https://i.imgur.com/ecGrFrH.png"];

    const upgrades = uniqueInfra.map((item, i) => ({
        id: `up${i}`, name: item.n,
        basePrice: Math.floor(15 * Math.pow(1.4, i)), 
        power: Math.floor(1 * Math.pow(1.2, i)), 
        type: i % 2 === 0 ? 'auto' : 'click', isHealing: item.h
    }));

    const achievements = [
        { id: 'cat', name: 'ã«ã‚ƒã‚“ã“ãƒ¯ãƒ¼ãƒ«ãƒ‰', icon: 'ğŸ±', desc: 'ã™ã¹ã¦ã®ä½æ°‘ãŒçŒ«ã§ã™ã€‚', unlocked: false, check: s => s.residents.length > 2 && s.residents.every(r => r.job === 'çŒ«') },
        { id: 'drama', name: 'æ„›ã¨æˆ¦äº‰', icon: 'ğŸ’”', desc: 'ä¸å€«é–¢ä¿‚ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', unlocked: false, check: s => s.residents.some(r => r.relType === 'ë¶ˆë¥œ') },
        { id: 'rich', name: 'å„„ä¸‡é•·è€…', icon: 'ğŸ’°', desc: 'æ‰€æŒé‡‘1,000,000çªç ´ã€‚', unlocked: false, check: s => s.money >= 1000000 },
        { id: 'solo', name: 'ã‚½ãƒ­å¤©å›½', icon: 'ğŸ§˜', desc: '5äººå…¨å“¡ãŒã‚½ãƒ­ã§ã™ã€‚', unlocked: false, check: s => s.residents.length === 5 && s.residents.every(r => r.relType === 'ì†”ë¡œ') },
        { id: 'stress', name: 'ç‡ƒãˆå°½ãç—‡å€™ç¾¤', icon: 'ğŸ”¥', desc: 'ä½æ°‘ã®å¹³å‡ã‚¹ãƒˆãƒ¬ã‚¹ãŒ90%ä»¥ä¸Šã€‚', unlocked: false, check: s => s.residents.length > 0 && (s.residents.reduce((a,b)=>a+b.stress,0)/s.residents.length) > 90 },
        { id: 'collector', name: 'æ­´å²å­¦è€…', icon: 'ğŸ“œ', desc: 'ã™ã¹ã¦ã®éºç‰©(20ç¨®)ã®åé›†å®Œäº†ã€‚', unlocked: false, check: s => s.artifacts.every(a => a === true) }
    ];

    let setupIndex = 0;
    const tempResidents = []; 
    let snsPosts = [];

    window.onload = function() {
        init();
    };

    // [ìˆ˜ì •] 1. ì €ì¥ ê¸°ëŠ¥ (ì¼ë³¸ì–´íŒ í‚¤ê°’ ë¶„ë¦¬)
    function saveGame() {
        try {
            localStorage.setItem('midnight_cottage_v30_JP', JSON.stringify(state));
        } catch (e) {
            console.error("ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜å¤±æ•—", e);
        }
    }

    // [ìˆ˜ì •] 2. ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥
    function loadGame() {
        const saved = localStorage.getItem('midnight_cottage_v30_JP');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                Object.assign(state, parsed);
                return true; 
            } catch (e) {
                console.error("ã‚»ãƒ¼ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼", e);
                return false;
            }
        }
        return false; 
    }

    // [ìˆ˜ì •] 3. ê²Œì„ ì´ˆê¸°í™”
    function init() {
        state.upgrades = upgrades.map(u => ({ id: u.id, lv: 0, price: u.basePrice }));

        // ë¡œì»¬ ë°ì´í„°ë¥¼ ë¨¼ì € ì°¾ì•„ë³´ê³ , ìˆìœ¼ë©´ ë°”ë¡œ ê²Œì„ ì‹œì‘!
        if (loadGame()) {
            console.log("ğŸ“‚ ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰å®Œäº†");
            document.getElementById('start-screen').style.display = 'none';
            startGame();
            addHistory("ğŸ’» <b>ã‚·ã‚¹ãƒ†ãƒ :</b> å‰å›ã®ä½œæ¥­ã‚’ç¶šã‘ã¦é–‹å§‹ã—ã¾ã™ã€‚");
        } else {
            loadSetupUI(0);
        }
    }

    function loadSetupUI(idx) {
        setupIndex = idx;
        const countDisplay = document.getElementById('char-count');
        const nextBtn = document.getElementById('btn-next');
        const prevBtn = document.getElementById('btn-prev');
        const finishBtn = document.getElementById('btn-finish');
        const nameInput = document.getElementById('input-name');

        countDisplay.innerText = `${idx + 1} / 5`;
        
        const currentData = tempResidents[idx] || {};
        nameInput.value = currentData.name || '';
        document.getElementById('input-gender').value = currentData.gender || 'ë‚¨';
        document.getElementById('input-job').value = currentData.job || 'ç”»å®¶'; 

        prevBtn.style.display = idx === 0 ? 'none' : 'block';
        finishBtn.style.display = tempResidents.length > 0 || idx > 0 ? 'block' : 'none';

        if (idx === 4) {
            nextBtn.style.display = 'none'; 
            finishBtn.style.width = "100%"; 
        } else {
            nextBtn.style.display = 'block';
            nextBtn.innerText = `è¿½åŠ  (${idx + 1}/5)`;
            nextBtn.style.background = "#bb9af7";
        }
    }

    function saveCurrentInput() {
        const job = document.getElementById('input-job').value;
        const selectedDialogues = jobsData[job]; 
        const selectedEmoji = jobEmojis[job] || 'ğŸ‘¤';

        tempResidents[setupIndex] = {
            id: setupIndex,
            name: document.getElementById('input-name').value || `ä½æ°‘${setupIndex+1}`,
            emoji: selectedEmoji, 
            gender: document.getElementById('input-gender').value,
            job: job,
            stress: 0, 
            affection: 50, 
            partnerId: null, 
            relType: 'ì†”ë¡œ',
            dialogues: selectedDialogues
        };
    }

    function nextChar() {
        saveCurrentInput();
        if (setupIndex < 4) loadSetupUI(setupIndex + 1);
    }

    function prevChar() {
        if (setupIndex > 0) loadSetupUI(setupIndex - 1);
    }

    // [ìˆ˜ì •] 4. ì…ì£¼ ì‹œì‘ (ê°€ì¥ ì¤‘ìš”!)
    function finishSetup() {
        saveCurrentInput(); 
        state.residents = [...tempResidents]; 
        document.getElementById('start-screen').style.display = 'none';
        
        // ê²Œì„ ì‹œì‘
        startGame();

        // ğŸ”¥ ì…ì£¼í•˜ìë§ˆì ì¦‰ì‹œ ê°•ì œ ì €ì¥!
        saveGame(); 
        console.log("âœ… å…¥å±…å®Œäº†ã€å³æ™‚ä¿å­˜");
    }

    function startGame() {
        changeNews();
        setInterval(changeNews, 300000);
        render(); updateUI(); renderAchievements();
        
        setInterval(() => { 
            let boost = 1 + (state.artifacts.filter(x=>x).length * 0.1);
            let income = state.autoIncome * boost;
            if (state.residents.length > 0) {
                let avgStress = state.residents.reduce((a,b)=>a+b.stress, 0) / state.residents.length;
                if (avgStress > 80) income *= 0.5;
            }

            state.money += income / 10; 
            state.residents.forEach(r => r.stress = Math.min(100, r.stress + 0.007));
            updateUI(); 
            checkAchievements();
        }, 100);
        setInterval(randomDailyEvent, 25000);
        setInterval(generateSNSPost, 60000); 

        // ğŸ’¾ 4ì´ˆë§ˆë‹¤ ìë™ ì €ì¥ ì‹¤í–‰
        setInterval(saveGame, 4000);

        if (window.innerWidth <= 768) {
            spawnMessage('ğŸ’»ä½œæ¥­ãƒ•ã‚¡ã‚¤ãƒˆï¼ãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆãƒ»ã‚³ãƒ†ãƒ¼ã‚¸ã¸ã‚ˆã†ã“ãã€‚', 'event');
        }
    }

    function toggleModal(id) { 
        const m = document.getElementById(id); 
        if (m) {
            m.style.display = (m.style.display==='flex')?'none':'flex';
            if(id === 'sns-modal' && m.style.display === 'flex') {
                 document.getElementById('sns-dot').style.display = 'none'; 
            }
            if(id === 'shop-modal' && m.style.display === 'flex') {
                updateGachaUI();
            }
        }
    }

    const endingDialogues = {
        "ç”»å®¶": "ã“ã®éƒ¨å±‹ã®è‰²å½©ã¯ç§ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚ˆã‚Šç¾ã—ã‹ã£ãŸã€‚æ°¸é ã«è¨˜æ†¶ã™ã‚‹ã‚ˆã€‚",
        "å°èª¬å®¶": "ç§ãŸã¡ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã¯ã“ã“ã§çµ‚ã‚ã‚‹ã‘ã©ã€å›ã®ç‰©èªã¯ãšã£ã¨æ›¸ãç¶šã‘ã¦ã­ã€‚",
        "æ•™æˆ": "ã“ã“ã®è¨˜éŒ²ã¯æ­´å²ã«æ®‹ã‚‹ã ã‚ã†ã€‚å›ã®ãŠã‹ã’ã ã€‚",
        "ãƒªãƒ‘ãƒ¼ãƒ‰ã‚¯": "ä¿ºã®å¿ƒè‡“ã‚¨ãƒ³ã‚¸ãƒ³ã‚‚é«˜é³´ã‚‹ãœã€‚å®Œç’§ãªä¿®ç†ã ã£ãŸã€‚",
        "ASMR DJ": "ä»Šå¤œã¯ä¸€ç•ªç©ã‚„ã‹ãªé›¨éŸ³ã‚’èã‹ã›ã¦ã‚ã’ã‚‹ã€‚ãŠã‚„ã™ã¿ã€‚",
        "ãƒ¢ãƒ‡ãƒ«": "æ´¾æ‰‹ãªç…§æ˜ã‚ˆã‚Šã€ã“ã®éƒ¨å±‹ã®ã»ã®ã‹ãªãƒã‚ªãƒ³ã®æ–¹ãŒè‰¯ã‹ã£ãŸã‚ã€‚",
        "åˆ‘äº‹": "äº‹ä»¶çµ‚äº†ã€‚çŠ¯äººã¯â€¦ç§ãŸã¡ãŒæ¢ã—ã¦ã„ãŸå¹¸ç¦ã ã£ãŸã‹ã€‚",
        "ãƒãƒƒãƒˆãƒ©ãƒ³ãƒŠãƒ¼": "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ãŸããªã„ã‚µãƒ¼ãƒãƒ¼ã¯ã“ã“ãŒåˆã‚ã¦ã ã€‚",
        "ãƒ©ãƒ¼ãƒ¡ãƒ³å±‹": "ã„ã¤ã§ã‚‚ãŠã„ã§ã€‚æ¸©ã‹ã„ã‚¹ãƒ¼ãƒ—ä¸€æ¯ã¯ä¸€ç”Ÿã‚¿ãƒ€ã ã‹ã‚‰ã€‚",
        "æ¸©æ³‰ä¸»äºº": "å¿ƒã®å¢ã¾ã§ã™ã£ã‹ã‚Šæ´—ã„æµã›ãŸæ°—åˆ†ã ã‚ˆã€‚ã‚ã‚ŠãŒã¨ã†ã€‚",
        "ãƒãƒ¼ãƒã‚¹ã‚¿ãƒ¼": "æœ€å¾Œã®æ›²ã¯å›ã®ãŸã‚ã«ã‹ã‘ã‚‹ã‚ˆã€‚ã“ã®ãƒªã‚ºãƒ ã‚’å¿˜ã‚Œãªã„ã§ã€‚",
        "ãƒŸãƒ¥ãƒ¼ã‚¸ã‚·ãƒ£ãƒ³": "ä¿ºã®æœ€é«˜ã®åæ›²ã¯ã“ã®ã‚³ãƒ†ãƒ¼ã‚¸ã§èª•ç”Ÿã—ãŸã€‚ã‚µãƒ³ã‚­ãƒ¥ãƒ¼ï¼",
        "çŒ«": "ãƒ‹ãƒ£ãƒ¼ã€‚ï¼ˆå…ƒæ°—ã§ãªã€æœ€é«˜ã®ä¸‹åƒ•ã€‚ãƒãƒ¥ãƒ¼ãƒ«å¿˜ã‚Œã‚‹ãªã‚ˆã€‚ï¼‰",
        "VIP": "ã“ã‚Œã»ã©ä¾¡å€¤ã®ã‚ã‚‹æŠ•è³‡ã¯åˆã‚ã¦ã ãªã€‚ç´ æ™´ã‚‰ã—ã‹ã£ãŸã€‚"
    };

    function startEndingSequence() {
        const screen = document.getElementById('ending-sequence');
        const container = document.querySelector('.rolling-container');
        const emojiDiv = document.getElementById('end-emoji');
        const nameDiv = document.getElementById('end-name');
        const msgDiv = document.getElementById('end-msg');
        const finalScreen = document.getElementById('final-screen');

        screen.style.display = 'flex';
        let step = 0;
        
        function showNextResident() {
            if (step >= state.residents.length) {
                container.style.display = 'none';
                finalScreen.style.display = 'block';
                finalScreen.style.animation = 'fade-in 2s forwards';
                return;
            }
            const char = state.residents[step];
            const msg = endingDialogues[char.job] || "ä¸€ç·’ã§æ¥½ã—ã‹ã£ãŸã‚ˆã€‚å¹¸ã›ã«ãªã£ã¦ã­ï¼";
            emojiDiv.innerText = char.emoji;
            nameDiv.innerText = `${char.job} ${char.name}`;
            msgDiv.innerText = `"${msg}"`;
            container.classList.add('show');
            setTimeout(() => {
                container.classList.remove('show');
                setTimeout(() => {
                    step++;
                    showNextResident();
                }, 1000); 
            }, 4000); 
        }
        showNextResident();
    }

    function closeEndingSequence() {
        document.getElementById('ending-sequence').style.display = 'none';
    }

    function getGachaPrice() {
        const foundCount = state.artifacts.filter(x => x).length;
        return 10000 * Math.pow(2, foundCount);
    }

    function updateGachaUI() {
        const price = getGachaPrice();
        const btn = document.getElementById('btn-gacha');
        const priceText = document.getElementById('gacha-price');
        priceText.innerText = `ğŸ’µ ${price.toLocaleString()}`;
        if(state.artifacts.every(x => x)) {
            btn.disabled = true;
            btn.innerHTML = "å…¨éºç‰©ã®åé›†å®Œäº†ï¼";
        } else if(state.money < price) {
            btn.disabled = true;
        } else {
            btn.disabled = false;
        }
    }

    function buyArtifact() {
        const price = getGachaPrice();
        if(state.money >= price) {
            state.money -= price;
            const unfound = state.artifacts.map((v, i) => v === false ? i : null).filter(v => v !== null);
            if (unfound.length > 0) {
                const pick = unfound[Math.floor(Math.random()*unfound.length)];
                state.artifacts[pick] = true; 
                renderMuseum();
                showCenterPopup(artifactsData[pick].emoji, 'éºç‰©ã®å¾©å…ƒæˆåŠŸï¼', artifactsData[pick].name);
                addHistory(`ğŸº <b>éºç‰©å¾©å…ƒ:</b> [${artifactsData[pick].name}] å¾©å…ƒå®Œäº†ï¼ (åç›Š +10%)`);
            }
            updateUI();
            updateGachaUI();
            saveGame();
        }
    }

    function generateSNSPost() {
        if (state.residents.length === 0) return;
        const char = state.residents[Math.floor(Math.random() * state.residents.length)];
        let text = "";
        const generalPosts = ["ä»Šæ—¥ãƒ‘ãƒ¼ãƒ†ã‚£ã™ã‚‹äººï¼Ÿ", "å®¶ãŒæœ€é«˜ã€‚", "ã“ã®é€šã‚Šã€ã‚¤ã‚±ã¦ã‚‹ã­ã€‚", "ãƒãƒƒãƒ†ãƒªãƒ¼å……é›»ä¸­...", "èª­æ›¸ã«ã„ã„å¤œã€‚", "æš‡ã ã‹ã‚‰éŠã‚“ã§ï¼", "ã‚³ãƒ³ãƒ“ãƒ‹å¼å½“ã¯é£½ããŸã€‚", "èª°ã‹ç§ã®è‡ªè»¢è»Šç›—ã‚“ã ï¼Ÿ", "é›¨ã®æ—¥ã¯ãƒãƒ‚ãƒŸã§ã—ã‚‡ã€‚", "ãƒã‚ªãƒ³ã‚µã‚¤ãƒ³ãŒä»Šæ—¥ã«é™ã£ã¦ç¶ºéº—ã€‚", "çŒ«ã‹ã‚ã„ã„ã€‚", "äººç”Ÿã¨ã¯...", "çµ¦æ–™ã„ã¤å…¥ã‚‹ã®ï¼Ÿ", "å¤œé£Ÿã®ãŠã™ã™ã‚æ•™ãˆã¦ã€‚", "æ–°ã—ãã§ããŸåº—è¡Œãäººï¼Ÿ", "ä»Šæ—¥ã®å¤©æ°—ãƒ¤ãƒã‚¤ã€‚", "å‡ºå‹¤ã—ãŸããªã„ã€‚", "é€€å‹¤å¾Œã«ãƒ“ãƒ¼ãƒ«ä¸€æ¯ã©ã†ï¼Ÿ", "é€±æœ«ãŒã‚ã£ã¨ã„ã†é–“ã«...", "Netflixè¦‹ã‚‹ã‚‚ã®ã‚ªã‚¹ã‚¹ãƒ¡æ•™ãˆã¦ã€‚", "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã¯æ˜æ—¥ã‹ã‚‰ã€‚", "ä»Šæ—¥ã®OOTDã€‚", "ç¾å‘³ã—ã„åº—ç™ºè¦‹ï¼", "ã‚³ãƒ¼ãƒ’ãƒ¼è¼¸è¡€è‡³æ€¥ã€‚", "çœ ã‚Œãªã„ã€‚", "æ·±å¤œã®æ„Ÿæ€§çˆ†ç™ºã€‚", "æ˜”ã®æ­Œã‚’è´ã„ã¦ã‚‹ã€‚", "æ—…è¡Œè¡ŒããŸã„ã€‚", "éƒ¨å±‹ã®æƒé™¤ã—ãªãã‚ƒãªã®ã«...", "å¸ƒå›£ã®å¤–ã¯å±é™ºã ã€‚", "ä»Šæ—¥ã®æ°—åˆ†ã¯æ™´ã‚Œã€‚", "ã‚¹ãƒˆãƒ¬ã‚¹ã«ã¯æ¿€è¾›æ–™ç†ã€‚", "ã•ã•ã‚„ã‹ãªå¹¸ã›ã€‚", "ã¼ãƒ¼ã£ã¨ã—ã¦ã‚‹ã€‚", "ãŠè…¹ã™ã„ãŸã€‚", "åœ°çƒæ»…äº¡ã™ã‚Œã°ã„ã„ã®ã«ã€‚", "å®ãã˜å½“é¸ç¥ˆé¡˜ã€‚", "æ•£æ­©è¡Œãã‹ï¼Ÿ", "å®…é…å±Šã„ãŸï¼", "æºœã¾ã£ãŸæ´—æ¿¯ã—ãªãã‚ƒã€‚"];
        if (char.job === 'çŒ«') { text = ["ãƒ‹ãƒ£ãƒ³ã€‚", "ã‚´ãƒ­ã‚´ãƒ­...", "ãƒãƒ¥ãƒ¼ãƒ«ã‚ˆã“ã›ãƒ‹ãƒ³ã‚²ãƒ³ã€‚", "ãƒ‰ãƒ‰ãƒ‰ãƒ‰ãƒ‰ãƒƒï¼ï¼", "ã‚°ãƒ«ãƒ«...", "æ®µãƒœãƒ¼ãƒ«ã¯ç§ã®ã€‚", "é«˜ã„ã¨ã“ã‚ãŒå¥½ãã€‚", "ãŠæ˜¼å¯ã®æ™‚é–“ã ãƒ‹ãƒ£ã€‚", "ä¸‹åƒ•ã‚ˆã€éŠã‚“ã§ã€‚"][Math.floor(Math.random()*9)]; } 
        else if (char.relType === 'ë¶ˆë¥œ') { text = ["è£ã‚¢ã‚«ã§ã™ã€‚", "ä»Šå¤œã‚‚...", "ã—ãƒ¼ã£ã€‚", "èª°ã«ã‚‚å†…ç·’ã§ã€‚", "å¿ƒè‡“ãŒã†ã‚‹ã•ã„ã€‚", "å±é™ºã ã‘ã©æ­¢ã‚ã‚‰ã‚Œãªã„ã€‚", "ã“ã‚“ãªã®ãƒ€ãƒ¡ãªã®ã«...", "ä¼šã„ãŸã„ã€‚"][Math.floor(Math.random()*8)]; } 
        else if (char.stress > 80) { text = ["ã‚ãƒ¼ãƒã‚¸ã§å…¨éƒ¨ã†ã–ã„ã€‚", "è§¦ã‚‹ãªã€‚", "é€€ç¤¾ã—ãŸã„ã€‚", "ä¸–ç•Œãªã‚“ã¦æ»…ã³ã‚ã€‚", "ä½•ã‚‚ã—ãŸããªã„ã€‚", "é ­ç—›ã„ã€‚", "å…¨éƒ¨æŠ•ã’å‡ºã—ãŸã„ã€‚", "çˆ†ç™ºå¯¸å‰ã€‚"][Math.floor(Math.random()*8)]; } 
        else { text = generalPosts[Math.floor(Math.random() * generalPosts.length)]; }
        const post = { emoji: char.emoji, name: char.name, time: new Date().toLocaleTimeString().slice(0, 5), text: text };
        snsPosts.unshift(post);
        if (snsPosts.length > 20) snsPosts.pop();
        renderSNS();
        document.getElementById('sns-dot').style.display = 'block';
    }

    function renderSNS() {
        const feed = document.getElementById('sns-feed');
        if(feed) feed.innerHTML = snsPosts.map(p => `<div class="sns-post"><div class="sns-user"><div class="sns-avatar">${p.emoji}</div><div class="sns-name">${p.name}</div><div class="sns-time">${p.time}</div></div><div class="sns-text">${p.text}</div></div>`).join('');
    }

    function checkAchievements() {
        let changed = false;
        achievements.forEach(ach => {
            if (!ach.unlocked && ach.check(state)) {
                ach.unlocked = true;
                changed = true;
                showCenterPopup(ach.icon, "å®Ÿç¸¾é”æˆï¼", ach.name);
                addHistory(`ğŸ† <b>å®Ÿç¸¾é”æˆ:</b> [${ach.name}] - ${ach.desc}`);
            }
        });
        if (changed) { renderAchievements(); }
    }

    function renderAchievements() {
        document.getElementById('ach-grid').innerHTML = achievements.map(a => `<div class="ach-item ${a.unlocked ? 'unlocked' : ''}"><div class="ach-icon">${a.icon}</div><div class="ach-title">${a.name}</div><div class="ach-desc">${a.unlocked ? a.desc : '???' }</div></div>`).join('');
    }

    function spawnMessage(text, type) {
        const stack = document.getElementById('dialogue-stack');
        if(!stack) return;
        const bubble = document.createElement('div');
        bubble.className = `dialogue-bubble ${type}`;
        bubble.innerHTML = text;
        stack.appendChild(bubble);
        
        setTimeout(() => {
            bubble.style.animation = 'fade-out-bubble 0.5s forwards';
            setTimeout(() => bubble.remove(), 500);
        }, 3500);
    }

    function addHistory(msg) {
        const timeMsg = `[${new Date().toLocaleTimeString()}] ${msg}`;
        state.history.unshift(timeMsg);
        if (state.history.length > 50) state.history.pop();
        
        const list = document.getElementById('history-list');
        if (list) list.innerHTML = state.history.map(h => `<li>${h}</li>`).join('');
        
        const eventLog = document.getElementById('event-log');
        if (eventLog) eventLog.innerHTML = msg; 

        if (window.innerWidth <= 768) {
            let cleanMsg = msg.replace(/<[^>]*>?/gm, ''); 
            if(cleanMsg.includes(']')) cleanMsg = cleanMsg.split(']')[1].trim(); 
            spawnMessage(cleanMsg, 'event');
        }
    }

    function changeNews() {
        const newsList = ["é…¸æ€§é›¨æ³¨æ„å ± (ã‚¹ãƒˆãƒ¬ã‚¹UP)", "ãƒã‚ªãƒ³ç¥­ã‚Š (ãƒ’ãƒ¼ãƒªãƒ³ã‚°UP)", "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ (åç›ŠDOWN)", "ä¼æ¥­è£œåŠ©é‡‘ (åç›ŠUP)", "æ·±å¤œã®é™å¯‚ (å¹³å’Œ)"];
        const pick = newsList[Math.floor(Math.random()*newsList.length)];
        const banner = document.getElementById('news-banner');
        if (banner) banner.innerText = "ğŸ“¢ ä»Šæ—¥ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹: " + pick;
    }

    function showCenterPopup(emoji, title, sub) {
        const popup = document.createElement('div');
        popup.className = 'center-popup';
        popup.innerHTML = `<div style="font-size:40px;">${emoji}</div><div>${title}</div><div style="font-size:16px; color:#fff; font-weight:500;">[${sub}]</div>`;
        document.body.appendChild(popup);
        setTimeout(() => popup.remove(), 3000);
    }

    function showEvolutionToast(rankName) {
        const evo = document.createElement('div');
        evo.className = 'evo-toast';
        evo.innerHTML = `ğŸŒ™ ã‚³ãƒ†ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ é€²åŒ–ï¼<br><span style="font-size:18px; color:#fff;">[${rankName}] è§£ç¦</span>`;
        document.body.appendChild(evo);
        setTimeout(() => evo.remove(), 4000);
    }

    function closeModalByBg(e, id) {
        if (id === 'museum-modal') { if (!e.target.closest('.artifact-slot')) { toggleModal(id); } return; }
        if (e.target.id === id) { toggleModal(id); }
    }

    function selectRoom(rankIndex) {
        state.currentSelectedRank = rankIndex;
        updateUI();
        showCenterPopup('ğŸ–¼ï¸', 'èƒŒæ™¯å¤‰æ›´å®Œäº†ï¼', rankNames[rankIndex-1]);
        toggleModal('gallery-modal');
    }

    function render() {
        document.getElementById('res-grid').innerHTML = state.residents.map((r, i) => {
            let relText = r.relType === 'ì†”ë¡œ' ? 'ã‚½ãƒ­' : (r.relType === 'ì»¤í”Œ' ? 'ã‚«ãƒƒãƒ—ãƒ«' : 'ä¸å€«');
            if (r.partnerId !== null && state.residents[r.partnerId]) { relText = `${state.residents[r.partnerId].name}ã¨${relText}`; }
            const genderBg = r.gender === 'ì—¬' ? 'var(--female-bg)' : (r.gender === 'ë‚¨' ? 'var(--male-bg)' : '#444');
            return `<div class="res-card" onclick="talkToResident(${i})"><div class="res-icon-box" style="background: ${genderBg}">${r.emoji}</div><div class="stress-box"><div class="stress-fill" id="stress-${i}" style="width: ${r.stress}%"></div></div><div class="res-name">${r.name}</div><div class="res-job" style="font-size:8px;">${r.job}</div><div class="res-rel">${relText}</div></div>`;
        }).join('');
        
        document.getElementById('upgrade-list').innerHTML = state.upgrades.map((u, i) => {
            const data = upgrades[i];
            return `<div class="up-card"><div class="up-info"><h4>${data.name} <small>(Lv.${u.lv})</small></h4><div class="tags">${u.lv === 0 ? '<span class="tag-dev">â­ ç™ºå±•åº¦ +1</span>' : ''}${data.isHealing ? '<span class="tag-healing">ğŸŒ¿ ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆ</span>' : ''}</div><p>${data.type === 'click' ? 'ã‚¯ãƒªãƒƒã‚¯' : 'ç§’é–“'} +${data.power.toLocaleString()}</p></div><button class="buy-btn" id="btn-${u.id}" onclick="buy(${i})">ğŸ’µ ${u.price.toLocaleString()}</button></div>`;
        }).join('');
        renderMuseum();
    }

    function renderMuseum() {
        document.getElementById('museum-list').innerHTML = artifactsData.map((a, i) => `<div class="artifact-slot ${state.artifacts[i] ? 'found' : ''}" onclick="showArt(${i}, event)">${state.artifacts[i] ? a.emoji : '?'}</div>`).join('');
    }

    function showArt(i, e) { 
        e.stopPropagation(); 
        const descBox = document.getElementById('artifact-desc');
        if(state.artifacts[i]) descBox.innerText = `ãƒ†ã‚ªæ•™æˆ: "${artifactsData[i].desc}"`; 
        else descBox.innerText = "ã¾ã æœªåé›†ã®éºç‰©ã ã€‚é—‡å¸‚ã§æ¢ã—ã¦ã¿ã‚ˆã†ï¼";
    }

    function buy(idx) {
        const u = state.upgrades[idx], d = upgrades[idx];
        
        // 1. êµ¬ë§¤ ë¡œì§
        if(state.money >= u.price) {
            state.money -= u.price; 
            
            if(u.lv === 0) { 
                state.totalUniquePurchased++; 
                addHistory(`ğŸ—ï¸ <b>æ–°è¦æ–½è¨­:</b> [${d.name}] å»ºè¨­å®Œäº†ã€‚`); 
            }
            u.lv++;
            
            if(d.type === 'click') state.clickPower += d.power; 
            else state.autoIncome += d.power;
            
            if(d.isHealing) state.residents.forEach(r => r.stress = Math.max(0, r.stress - 20));
            
            u.price = Math.floor(u.price * 1.6);
            
            const newRank = Math.min(20, Math.floor(state.totalUniquePurchased / 5) + 1);
            if (newRank > state.rank) {
                state.rank = newRank; 
                state.currentSelectedRank = newRank;
                showEvolutionToast(rankNames[newRank-1]);
                addHistory(`ğŸŒŸ <b>éƒ½å¸‚é€²åŒ–:</b> [${rankNames[newRank-1]}] é”æˆï¼`);
                
                if (newRank >= 20 && !state.endingSeen) { 
                    state.endingSeen = true; 
                    startEndingSequence(); 
                }
            }
            
            render(); 
            updateUI();
            
            // ğŸ”¥ [ìˆ˜ì •] ëˆ ì¼ìœ¼ë‹ˆê¹Œ ë°”ë¡œ ì €ì¥!
            saveGame();
        }

        // 2. ë²„íŠ¼ ë½€ì‰ ì—°ì¶œ
        const btn = document.getElementById(`btn-${u.id}`);
        if (btn) {
            btn.classList.remove('click-animate'); 
            void btn.offsetWidth; // ì• ë‹ˆë©”ì´ì…˜ ë¦¬ì…‹ ë§¤ì§ ì½”ë“œ
            btn.classList.add('click-animate'); 
        }
    }

    function updateUI() {
        document.getElementById('budget').innerText = Math.floor(state.money).toLocaleString();
        state.upgrades.forEach(u => { const btn = document.getElementById(`btn-${u.id}`); if(btn) btn.disabled = state.money < u.price; });
        state.residents.forEach((r, i) => { const fill = document.getElementById(`stress-${i}`); if(fill) fill.style.width = r.stress + '%'; });
        const currentProgress = state.totalUniquePurchased % 5;
        const displayRankName = `Rank.${state.currentSelectedRank} ${rankNames[state.currentSelectedRank-1]}`;
        const displayProgress = (currentProgress * 20) + '%';
        const displayCount = `${currentProgress} / 5`;
        if(document.getElementById('dev-bar-fill')) document.getElementById('dev-bar-fill').style.width = displayProgress;
        if(document.getElementById('dev-count')) document.getElementById('dev-count').innerText = displayCount;
        if(document.getElementById('city-name-display')) document.getElementById('city-name-display').innerText = displayRankName;
        if(document.getElementById('mob-dev-bar-fill')) document.getElementById('mob-dev-bar-fill').style.width = displayProgress;
        if(document.getElementById('mob-dev-count')) document.getElementById('mob-dev-count').innerText = displayCount;
        if(document.getElementById('mob-city-name-display')) document.getElementById('mob-city-name-display').innerText = displayRankName;
        document.getElementById('desk-clicker').src = rankImages[state.currentSelectedRank-1];
        const artCount = state.artifacts.filter(x=>x).length;
        if (document.getElementById('artifact-boost')) document.getElementById('artifact-boost').innerText = artCount > 0 ? `(éºç‰©ãƒãƒ• +${artCount*10}%)` : "";
    }

    function talkToResident(idx) {
        const res = state.residents[idx];
        if(!res) return;
        let pool = res.dialogues['Solo'];
        if (res.stress > 80) pool = res.dialogues['Stress'];
        const msg = pool[Math.floor(Math.random()*pool.length)];
        
        spawnMessage(`${res.name}: "${msg}"`, 'talk');
    }

    function randomDailyEvent() {
        if (state.residents.length < 2) return;

        // ëœë¤í•˜ê²Œ ë‘ ëª… ë½‘ê¸°
        const p1 = Math.floor(Math.random() * state.residents.length);
        let p2 = Math.floor(Math.random() * state.residents.length);
        while(p1 === p2) { p2 = Math.floor(Math.random() * state.residents.length); } 
        
        const charA = state.residents[p1];
        const charB = state.residents[p2];
        const rand = Math.random();

        // 1. ëŒ€í™” ë° í˜¸ê°ë„ ë³€í™”
        if (rand < 0.45) {
            charA.affection += 5; charB.affection += 5;
            addHistory(`ğŸ’¬ <b>ä¼šè©±:</b> ${charA.name}ã¨${charB.name}ã¯æ¥½ã—ããŠã—ã‚ƒã¹ã‚Šã‚’ã—ãŸã€‚<span style="color:var(--heart)">(â¤ï¸+5)</span>`);
        } else if (rand < 0.65) {
            charA.affection -= 10; charB.affection -= 10; // ì‹¸ìš°ë©´ í˜¸ê°ë„ ë” ë§ì´ ê¹ì„
            addHistory(`âš¡ <b>å£è«–:</b> ${charA.name}ã¨${charB.name}ã¯äº›ç´°ãªèª¤è§£ã§è¨€ã„äº‰ã£ãŸã€‚<span style="color:#888">(ğŸ’”-10)</span>`);
        }

        // í˜¸ê°ë„ 0~100 ì œí•œ
        state.residents.forEach(r => { r.affection = Math.max(0, Math.min(100, r.affection)); });

        // 2. ê´€ê³„ ë³€í™” ë¡œì§
        
        // A. [ì´ë³„] ì»¤í”Œì¸ë° í˜¸ê°ë„ê°€ 30 ë¯¸ë§Œìœ¼ë¡œ ë–¨ì–´ì§€ë©´ í—¤ì–´ì§
        if (charA.partnerId === charB.id && (charA.affection < 30 || charB.affection < 30)) {
            charA.relType = 'ì†”ë¡œ'; charB.relType = 'ì†”ë¡œ';
            charA.partnerId = null; charB.partnerId = null;
            
            showCenterPopup("ğŸ’”", "æ±ºåˆ¥", `${charA.name} âš¡ ${charB.name}`);
            addHistory(`ğŸ’” <b>åˆ¥ã‚Œ:</b> ${charA.name}ã¨${charB.name}ã¯æ€§æ ¼ã®ä¸ä¸€è‡´ã‚’å…‹æœã§ããšä»–äººã«ãªã£ãŸã€‚`);
            saveGame();
        }

        // B. [ì»¤í”Œ íƒ„ìƒ] ë‘˜ ë‹¤ ì†”ë¡œì´ê³  í˜¸ê°ë„ê°€ 90 ì´ìƒì¼ ë•Œ
        else if (charA.affection >= 90 && charB.affection >= 90) {
            if (charA.relType === 'ì†”ë¡œ' && charB.relType === 'ì†”ë¡œ') {
                charA.relType = 'ì»¤í”Œ'; charB.relType = 'ì»¤í”Œ';
                charA.partnerId = charB.id; charB.partnerId = charA.id;
                
                showCenterPopup("ğŸ’–", "ã‚«ãƒƒãƒ—ãƒ«èª•ç”Ÿï¼", `${charA.name} â™¥ ${charB.name}`);
                addHistory(`ğŸ’– <b>ãŠã‚ã§ã¨ã†ï¼</b> ${charA.name}ã¨${charB.name}ã¯æ‹äººã«ãªã£ãŸï¼`);
                saveGame();
            }
            
            // C. [ë¶ˆë¥œ] í•œ ëª…ì´ë¼ë„ íŒŒíŠ¸ë„ˆê°€ ìˆëŠ”ë° í˜¸ê°ë„ê°€ ë†’ì„ ë•Œ
            else if (charA.partnerId !== charB.id && (charA.relType === 'ì»¤í”Œ' || charB.relType === 'ì»¤í”Œ')) {
                if (charA.relType !== 'ë¶ˆë¥œ' || charB.relType !== 'ë¶ˆë¥œ') {
                    charA.relType = 'ë¶ˆë¥œ'; charB.relType = 'ë¶ˆë¥œ';
                    showCenterPopup("ğŸ˜ˆ", "å±é™ºãªé–¢ä¿‚", `${charA.name} & ${charB.name}`);
                    addHistory(`ğŸ˜ˆ <b>è¡æ’ƒï¼</b> ${charA.name}ã¨${charB.name}ã¯ç¦æ–­ã®æ„›ã«è½ã¡ã¦ã—ã¾ã£ãŸ...`);
                    saveGame();
                }
            }
        }

        render(); // í™”ë©´ ê°±ì‹ 
    }

    document.getElementById('desk-clicker').onclick = (e) => { 
        state.money += state.clickPower; 
        const star = document.createElement('div'); star.className = 'hit-effect'; star.innerText = 'ğŸŒŸ';
        star.style.left = (e.clientX - 32) + 'px'; star.style.top = (e.clientY - 32) + 'px';
        document.body.appendChild(star); setTimeout(() => star.remove(), 300);
        updateUI(); 
    };

    function resetGame() {
        if (confirm("æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦å…¥å±…ç”³è¾¼æ›¸ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ\n(æ³¨æ„: ãƒ‡ãƒ¼ã‚¿ãŒæ°¸ä¹…ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚)")) {
            localStorage.removeItem('midnight_cottage_v30_JP');
            alert("ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¾ã™ã€‚");
            location.reload();
        }
    }

    function openGallery() {
        const grid = document.getElementById('gallery-grid');
        grid.innerHTML = rankNames.map((name, i) => {
            const unlocked = i < state.rank;
            const isSelected = (i + 1) === state.currentSelectedRank;
            return `<div class="gallery-item ${unlocked ? 'unlocked' : 'locked'} ${isSelected ? 'active' : ''}" onclick="${unlocked ? `selectRoom(${i+1})` : ''}"><img src="${rankImages[i]}" loading="lazy"><div style="background:rgba(0,0,0,0.6); color:#fff; font-size:12px; font-weight:700;">${i+1}. ${name} ${isSelected ? ' (ä½¿ç”¨ä¸­)' : ''}</div></div>`;
        }).join('');
        toggleModal('gallery-modal');
    }
</script>
</body>
</html>
